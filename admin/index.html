<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="robots" content="noindex, nofollow">
    <title>ÁÆ°ÁêÜÂêéÂè∞</title>
    <script src="https://cdn.jsdelivr.net/npm/@keeex/qrcodejs-kx@1.0.2/qrcode.min.js"></script>
    <style>
        /* Âü∫Á°ÄÈáçÁΩÆ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            overflow: hidden
        }

        /* ÈÄöÁî®Âä®Áîª */
        @keyframes blurOverlayAppear {
            0% {
                opacity: 0;
                -webkit-backdrop-filter: blur(0px);
                backdrop-filter: blur(0px);
            }

            100% {
                opacity: 1;
                -webkit-backdrop-filter: blur(12px);
                backdrop-filter: blur(12px);
            }
        }

        @keyframes containerAppear {
            0% {
                opacity: 0;
                transform: translateY(30px) scale(0.9)
            }

            100% {
                opacity: 1;
                transform: translateY(0) scale(1)
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0
            }

            to {
                opacity: 1
            }
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0)
            }

            10%,
            30%,
            50%,
            70%,
            90% {
                transform: translateX(-5px)
            }

            20%,
            40%,
            60%,
            80% {
                transform: translateX(5px)
            }
        }

        @keyframes gradientShift {
            0% {
                background-position: 0 50%
            }

            50% {
                background-position: 100% 50%
            }

            100% {
                background-position: 0 50%
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px)
            }

            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        @keyframes rotate {
            from {
                transform: rotate(0deg)
            }

            to {
                transform: rotate(360deg)
            }
        }

        /* ËÉåÊôØÂíåÈÅÆÁΩ©Â±Ç */
        #background-iframe {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
            z-index: -3 !important
        }

        #blur-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0, rgba(118, 75, 162, 0.15) 100%);
            -webkit-backdrop-filter: blur(12px);
            backdrop-filter: blur(12px);
            z-index: -2 !important;
            animation: blurOverlayAppear 1.5s ease-out forwards .3s;
            pointer-events: none;
            opacity: 0
        }

        /* ÈÄöÁî®ÂÆπÂô®ÂåÖË£ÖÂô® */
        .page-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1 !important;
            padding: 20px;
            overflow-y: auto
        }

        /* ÈÄöÁî®Âç°ÁâáÂÆπÂô® */
        .card-container {
            background: rgba(255, 255, 255, 0.95);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            padding: 50px 40px;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.1) inset;
            width: 100%;
            animation: containerAppear 1s ease-out .8s backwards;
            position: relative;
            overflow: hidden
        }

        .card-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #faab41 0, #f6821f 50%, #faab41 100%);
            background-size: 200% 100%;
            animation: gradientShift 3s ease infinite
        }

        /* È°µÈù¢Ê†áÈ¢òÂíåÂõæÊ†á */
        .page-header {
            margin-bottom: 35px;
            text-align: center
        }

        .page-icon {
            width: 70px;
            height: 70px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, #faab41 0, #f6821f 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
            animation: fadeIn .8s ease-out 1s backwards
        }

        .page-icon svg {
            width: 36px;
            height: 36px;
            fill: white
        }

        .page-title {
            font-size: 32px;
            font-weight: 700;
            background: linear-gradient(135deg, #faab41 0, #f6821f 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0 0 12px;
            line-height: 1.2;
            letter-spacing: -0.5px
        }

        .page-subtitle {
            font-size: 16px;
            color: #6b7280;
            margin: 0;
            line-height: 1.5;
            font-weight: 400
        }

        /* Ë°®ÂçïÊ†∑Âºè */
        .page-form {
            display: flex;
            flex-direction: column;
            margin-top: 35px
        }

        .form-group {
            margin-bottom: 24px;
            text-align: left;
            position: relative
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            letter-spacing: .3px
        }

        .input-wrapper {
            position: relative
        }

        .input-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            opacity: .4;
            pointer-events: none;
            transition: opacity .3s ease
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 16px;
            border: 2px solid #e5e7eb !important;
            border-radius: 12px;
            font-size: 16px;
            color: #1f2937 !important;
            background-color: #fff !important;
            box-sizing: border-box;
            transition: all .3s ease;
            -webkit-appearance: none;
            appearance: none;
            font-family: inherit
        }

        .form-group input.with-icon {
            padding-left: 48px
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: 0 !important;
            border-color: #faab41 !important;
            box-shadow: 0 0 0 4px rgba(250, 171, 65, 0.1) !important
        }

        .form-group input:focus+.input-icon {
            opacity: .7
        }

        .form-group input:disabled,
        .form-group select:disabled {
            background-color: #f3f4f6 !important;
            color: #9ca3af !important;
            cursor: not-allowed;
            opacity: 1
        }

        .form-group input[readonly] {
            background-color: #f9fafb !important;
            color: #6b7280 !important
        }

        .form-group textarea {
            resize: vertical;
            min-height: 382px;
            font-family: 'Monaco', 'Courier New', monospace
        }

        /* ÊåâÈíÆÊ†∑Âºè */
        .btn {
            padding: 10px 20px;
            border: 0;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all .3s ease;
            box-sizing: border-box;
            -webkit-appearance: none;
            appearance: none;
            letter-spacing: .5px;
            position: relative;
            overflow: hidden
        }

        .btn-primary {
            background: linear-gradient(135deg, #faab41 0, #f6821f 100%);
            color: #fff;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4)
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left .5s ease
        }

        .btn-primary:hover::before {
            left: 100%
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.5)
        }

        .btn-primary:active {
            transform: translateY(0);
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.4)
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #374151
        }

        .btn-secondary:hover {
            background: #d1d5db
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none
        }

        .btn-group {
            display: flex;
            gap: 10px
        }

        /* È°µËÑöÊèêÁ§∫ */
        .footer-hint {
            margin-top: 30px;
            font-size: 13px;
            color: #9ca3af;
            animation: fadeIn 1s ease-out 1.5s backwards;
            text-align: center
        }

        .footer-hint a {
            color: #faab41;
            text-decoration: none;
            font-weight: 500;
            transition: color .3s ease
        }

        .footer-hint a:hover {
            color: #f6821f
        }

        /* Toast ÈÄöÁü• */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
            font-weight: 500;
            z-index: 10000000;
            transform: translateX(100%);
            transition: transform 0.3s ease, opacity 0.3s ease;
            opacity: 0;
            max-width: 300px;
            word-wrap: break-word
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1
        }

        .toast-success {
            background: linear-gradient(135deg, #10b981 0, #059669 100%);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3)
        }

        .toast-error {
            background: linear-gradient(135deg, #ef4444 0, #dc2626 100%);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3)
        }

        .toast-info {
            background: linear-gradient(135deg, #3b82f6 0, #1d4ed8 100%);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3)
        }

        /* Ê∂àÊÅØÊèêÁ§∫ */
        .message {
            margin-top: 24px;
            font-size: 14px;
            line-height: 1.5;
            padding: 14px 18px;
            border-radius: 12px;
            font-weight: 500;
            animation: slideIn .3s ease-out
        }

        .message-success {
            background: linear-gradient(135deg, #10b981 0, #059669 100%);
            color: #fff;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3)
        }

        .message-error {
            background: linear-gradient(135deg, #ef4444 0, #dc2626 100%);
            color: #fff;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
            animation: shake .5s ease-in-out, slideIn .3s ease-out
        }

        /* Ê®°ÊÄÅÊ°Ü */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000000000;
            justify-content: center;
            align-items: center
        }

        .modal-overlay.show {
            display: flex
        }

        .modal {
            background: #fff;
            border-radius: 16px;
            padding: 30px;
            max-width: 500px;
            width: 95%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
            z-index: 2000000001;
            position: relative
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #9ca3af
        }

        .modal-close:hover {
            color: #1f2937
        }

        /* Á§æ‰∫§ÈìæÊé• */
        .social-links {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            padding: 10px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1)
        }

        .social-text {
            font-size: 14px;
            color: #666;
            margin-right: 10px
        }

        .social-link {
            display: inline-block;
            background: none;
            border: none;
            color: #666;
            text-decoration: none;
            cursor: pointer;
            transition: color 0.3s ease;
            border-radius: 8px;
            padding: 6px;
            border: 1px solid transparent
        }

        .social-link:hover {
            color: #faab41;
            border-color: #faab41;
            transform: translateY(-2px)
        }

        .social-link svg {
            width: 20px;
            height: 20px
        }

        /* Â§çÈÄâÊ°ÜÊ†∑Âºè */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            padding: 0;
            border: 2px solid #e5e7eb;
            border-radius: 4px;
            -webkit-appearance: none;
            appearance: none;
            position: relative;
            transition: all 0.3s ease;
            background-color: #fff
        }

        .checkbox-group input[type="checkbox"]:hover {
            border-color: #faab41
        }

        .checkbox-group input[type="checkbox"]:checked {
            background: linear-gradient(135deg, #faab41 0, #f6821f 100%);
            border-color: #faab41
        }

        .checkbox-group input[type="checkbox"]:checked::after {
            content: '';
            position: absolute;
            left: 5px;
            top: 2px;
            width: 4px;
            height: 8px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg)
        }

        .checkbox-group input[type="checkbox"]:disabled {
            background-color: #f3f4f6;
            border-color: #d1d5db;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .checkbox-group input[type="checkbox"]:disabled:hover {
            border-color: #d1d5db;
        }

        .checkbox-label {
            font-size: 14px;
            color: #374151;
            cursor: pointer;
            -webkit-user-select: none;
            user-select: none;
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° - Âπ≥Êùø */
        @media(max-width:768px) {
            .page-wrapper {
                padding: 20px 16px;
                padding-top: 20px;
                padding-bottom: 20px;
                justify-content: flex-start;
                align-items: center
            }

            .card-container {
                padding: 40px 28px;
                border-radius: 20px;
                max-width: 100%;
                margin-top: auto;
                margin-bottom: auto
            }

            .page-icon {
                width: 60px;
                height: 60px;
                border-radius: 16px;
                margin-bottom: 16px
            }

            .page-icon svg {
                width: 30px;
                height: 30px
            }

            .page-title {
                font-size: 26px;
                margin-bottom: 10px
            }

            .page-subtitle {
                font-size: 15px
            }

            .page-form {
                margin-top: 28px
            }

            .form-group {
                margin-bottom: 20px
            }

            .form-group label {
                font-size: 13px;
                margin-bottom: 8px
            }

            .form-group input,
            .form-group select,
            .form-group textarea {
                padding: 14px;
                font-size: 16px;
                border-radius: 10px
            }

            .form-group input.with-icon {
                padding-left: 44px
            }

            .input-icon {
                left: 14px;
                width: 18px;
                height: 18px
            }

            .btn {
                padding: 15px 20px;
                font-size: 15px;
                border-radius: 10px
            }

            .message {
                margin-top: 20px;
                font-size: 13px;
                padding: 12px 16px;
                border-radius: 10px
            }

            .footer-hint {
                margin-top: 24px;
                font-size: 12px
            }
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° - ÊâãÊú∫ */
        @media(max-width:480px) {
            .page-wrapper {
                padding: 12px;
                justify-content: flex-start;
                align-items: center
            }

            .card-container {
                padding: 35px 24px;
                border-radius: 18px;
                margin-top: auto;
                margin-bottom: auto
            }

            .page-icon {
                width: 55px;
                height: 55px;
                border-radius: 14px
            }

            .page-icon svg {
                width: 28px;
                height: 28px
            }

            .page-title {
                font-size: 24px
            }

            .page-subtitle {
                font-size: 14px
            }
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° - Ê®™Â±è */
        @media(max-height:600px) and (orientation:landscape) {
            .page-wrapper {
                padding: 20px;
                justify-content: flex-start;
                align-items: center
            }

            .card-container {
                padding: 30px 35px;
                margin-top: auto;
                margin-bottom: auto
            }

            .page-icon {
                width: 50px;
                height: 50px;
                margin-bottom: 12px
            }

            .page-icon svg {
                width: 26px;
                height: 26px
            }

            .page-title {
                font-size: 22px;
                margin-bottom: 8px
            }

            .page-subtitle {
                font-size: 13px
            }

            .page-form {
                margin-top: 20px
            }

            .form-group {
                margin-bottom: 16px
            }

            .footer-hint {
                margin-top: 16px
            }
        }

        /* Â§úÈó¥Ê®°Âºè */
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: rgba(255, 255, 255, 0.95);
            --text-primary: #1f2937;
            --text-secondary: #666;
            --border-color: #e5e7eb;
            --border-light: rgba(255, 255, 255, 0.1);
            --input-bg: #f3f4f6;
            --input-border: #e5e7eb;
            --overlay-bg: rgba(255, 255, 255, 0.7);
            --blur-overlay: rgba(0, 0, 0, 0.3)
        }

        html.dark-mode {
            --bg-primary: #1a1a1a;
            --bg-secondary: #0f0d0a;
            --text-primary: #e5e5e5;
            --text-secondary: #a0a0a0;
            --border-color: #333333;
            --border-light: rgba(255, 255, 255, 0.1);
            --input-bg: #2a2a2a;
            --input-border: #444444;
            --overlay-bg: rgba(32, 32, 32, 0.7);
            --blur-overlay: rgba(0, 0, 0, 0.5)
        }

        html.dark-mode body {
            background: linear-gradient(135deg, #1a1a1a 0, #2a2a2a 50%, #1a1a1a 100%) !important;
            color: var(--text-primary)
        }

        html.dark-mode #blur-overlay {
            background: var(--blur-overlay)
        }

        html.dark-mode .card-container {
            color: var(--text-primary)
        }

        html.dark-mode .page-wrapper {
            background: transparent
        }

        html.dark-mode .header {
            background: rgba(39, 39, 39, 0.95);
            border-image: linear-gradient(90deg, #7c3aed 0, #5b21b6 50%, #7c3aed 100%) 1
        }

        html.dark-mode .module {
            background: rgba(39, 39, 39, 0.95);
            color: var(--text-primary)
        }

        html.dark-mode .module-title {
            color: var(--text-primary)
        }

        html.dark-mode .form-group input:not([type="checkbox"]),
        html.dark-mode .form-group select,
        html.dark-mode .form-group textarea {
            background: var(--input-bg) !important;
            color: var(--text-primary) !important;
            border-color: var(--input-border) !important
        }

        html.dark-mode .form-group input:not([type="checkbox"])::placeholder,
        html.dark-mode .form-group textarea::placeholder {
            color: var(--text-secondary) !important
        }

        html.dark-mode .form-group input:not([type="checkbox"]):focus,
        html.dark-mode .form-group select:focus,
        html.dark-mode .form-group textarea:focus {
            border-color: #7c3aed !important;
            box-shadow: 0 0 0 4px rgba(124, 58, 237, 0.1) !important
        }

        html.dark-mode .form-group input:not([type="checkbox"]):disabled,
        html.dark-mode .form-group select:disabled {
            background-color: var(--input-bg) !important;
            color: var(--text-secondary) !important
        }

        html.dark-mode .form-group input:not([type="checkbox"])[readonly] {
            background-color: var(--input-bg) !important;
            color: var(--text-secondary) !important
        }

        html.dark-mode .module .form-group input,
        html.dark-mode .module .form-group select,
        html.dark-mode .module .form-group textarea {
            background: var(--input-bg);
            color: var(--text-primary);
            border-color: var(--input-border)
        }

        html.dark-mode .module .form-group input::placeholder,
        html.dark-mode .module .form-group textarea::placeholder {
            color: var(--text-secondary)
        }

        html.dark-mode .modal-overlay {
            background: var(--blur-overlay)
        }

        html.dark-mode .modal {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-color: var(--border-color)
        }

        html.dark-mode .modal input,
        html.dark-mode .modal select,
        html.dark-mode .modal textarea {
            background: var(--input-bg);
            color: var(--text-primary);
            border-color: var(--input-border)
        }

        html.dark-mode .form-group label {
            color: var(--text-primary) !important
        }

        html.dark-mode .card-container {
            color: var(--text-primary);
        }

        html.dark-mode .modal-close {
            color: var(--text-primary)
        }

        html.dark-mode .page-header {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-image: linear-gradient(90deg, #7c3aed 0, #5b21b6 50%, #7c3aed 100%) 1 !important
        }

        html.dark-mode .page-title {
            color: var(--text-primary) !important
        }

        html.dark-mode .page-subtitle {
            color: var(--text-secondary) !important
        }

        html.dark-mode table {
            color: var(--text-primary)
        }

        html.dark-mode thead {
            background: #2a2a2a !important
        }

        html.dark-mode thead th {
            background: #2a2a2a !important;
            color: var(--text-primary) !important;
            border-color: #333333 !important
        }

        html.dark-mode tbody tr {
            border-color: #333333
        }

        html.dark-mode tbody td {
            color: var(--text-primary)
        }

        html.dark-mode .social-link {
            color: var(--text-secondary)
        }

        html.dark-mode .social-link:hover {
            color: #7c3aed;
            border-color: #7c3aed
        }

        html.dark-mode .social-links {
            border-color: rgba(255, 255, 255, 0.1)
        }

        html.dark-mode .btn-secondary {
            background: var(--input-bg) !important;
            color: var(--text-primary) !important;
            border-color: var(--input-border) !important
        }

        html.dark-mode .btn-qrcode {
            background: linear-gradient(135deg, #0891b2 0, #065f73 100%) !important;
            color: #fff !important;
            box-shadow: 0 4px 15px rgba(8, 145, 178, 0.3) !important;
        }

        html.dark-mode .checkbox-group input[type="checkbox"] {
            border-color: var(--border-color);
            background: var(--input-bg)
        }

        html.dark-mode .checkbox-group input[type="checkbox"]:checked {
            background: linear-gradient(135deg, #7c3aed 0, #5b21b6 100%);
            border-color: #7c3aed
        }

        html.dark-mode .loading {
            border-color: rgba(124, 58, 237, 0.3);
            border-top-color: #7c3aed
        }

        html.dark-mode .message {
            animation: slideIn .3s ease-out
        }

        html.dark-mode .success-message {
            background: linear-gradient(135deg, #059669 0, #047857 100%)
        }

        html.dark-mode .error-message {
            background: linear-gradient(135deg, #dc2626 0, #b91c1c 100%)
        }

        html.dark-mode .collapse-btn {
            color: #7c3aed
        }

        html.dark-mode .collapse-btn:hover {
            color: #9f7aea
        }

        html.dark-mode .collapse-section {
            border-left-color: #7c3aed;
            color: var(--text-primary)
        }

        html.dark-mode .module-footer {
            border-color: rgba(255, 255, 255, 0.1)
        }

        html.dark-mode .readonly-wrapper input[readonly] {
            background-color: var(--input-bg) !important;
            border-color: var(--input-border) !important;
            color: var(--text-primary) !important;
        }

        html.dark-mode .readonly-wrapper input[readonly]:hover {
            border-color: #7c3aed;
            background-color: var(--input-bg);
        }

        html.dark-mode .subapi-input {
            background-color: var(--input-bg) !important;
            color: var(--text-primary) !important;
        }

        html.dark-mode .input-icon {
            opacity: 0.6
        }

        html.dark-mode .module-title {
            color: var(--text-primary) !important
        }

        html.dark-mode .module-title .collapse-icon {
            fill: var(--text-secondary)
        }

        html.dark-mode .footer-hint {
            color: var(--text-secondary) !important
        }

        html.dark-mode .footer-hint a {
            color: #7c3aed !important
        }

        html.dark-mode .footer-hint a:hover {
            color: #9f7aea !important
        }

        .theme-icon {
            transition: transform 0.3s ease
        }

        .social-link.theme-toggle:hover .theme-icon {
            transform: rotate(20deg)
        }

        .social-link.theme-toggle {
            font-size: 0;
            line-height: 0
        }

        .theme-icon {
            width: 20px;
            height: 20px;
            display: block !important;
            transition: all 0.3s ease
        }

        .sun-icon {
            display: none !important;
            opacity: 0
        }

        .moon-icon {
            display: block !important;
            opacity: 1
        }

        html.dark-mode .sun-icon {
            display: block !important;
            opacity: 1
        }

        html.dark-mode .moon-icon {
            display: none !important;
            opacity: 0
        }

        .page-wrapper {
            justify-content: flex-start;
            align-items: flex-start
        }

        .card-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0;
            background: transparent !important;
            box-shadow: none !important
        }

        .card-container::before {
            display: none
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.95);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            padding: 25px 30px;
            border-radius: 16px;
            border-top: 4px solid;
            border-image: linear-gradient(90deg, #faab41 0, #f6821f 50%, #faab41 100%) 1
        }

        .header-title h1 {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, #faab41 0, #f6821f 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0
        }

        .header-buttons {
            display: flex;
            gap: 12px
        }

        .header .btn {
            padding: 10px 20px;
            font-size: 14px;
            border-radius: 8px
        }

        .module {
            background: rgba(255, 255, 255, 0.95);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 4px 4px 8px -3px rgba(0, 0, 0, 0.12);
            transition: box-shadow 280ms cubic-bezier(.2, .9, .2, 1), transform 220ms ease;
            will-change: transform
        }

        .module:hover,
        .module:focus-within {
            box-shadow: 0 8px 16px -2px rgba(0, 0, 0, 0.14), 0 0 12px rgba(250, 171, 65, 0.08);
            transform: translateY(-4px)
        }

        .module-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #1f2937;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer
        }

        .module-title .collapse-icon {
            width: 24px;
            height: 24px;
            transition: transform 0.28s;
            fill: #666
        }

        .module.collapsed .collapse-icon {
            transform: rotate(90deg)
        }

        .module-content {
            display: block;
            overflow: hidden;
            max-height: 2000px;
            opacity: 1;
            transition: max-height 320ms cubic-bezier(.2, .8, .2, 1), opacity 220ms ease
        }

        .module.collapsed .module-content {
            max-height: 0;
            opacity: 0
        }

        .module .form-group {
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 20px;
            align-items: center;
            text-align: left
        }

        .module .form-group label {
            display: block
        }

        .module .form-group input,
        .module .form-group select,
        .module .form-group textarea {
            padding: 8px 8px;
            border-radius: 8px
        }

        .module .input-wrapper {
            display: flex;
            align-items: center;
            gap: 10px
        }

        .module .input-wrapper input {
            flex: 1
        }

        .readonly-wrapper {
            position: relative
        }

        .readonly-wrapper input[readonly] {
            cursor: pointer;
            background-color: #fff !important;
            border: 2px solid #e5e7eb !important;
            color: #1f2937 !important;
        }

        .readonly-wrapper input[readonly]:hover {
            border-color: #faab41;
            background-color: #fff;
        }

        .readonly-wrapper input[readonly]:focus {
            outline: 0 !important;
            border-color: #faab41 !important;
            box-shadow: 0 0 0 4px rgba(250, 171, 65, 0.1) !important;
        }

        .copy-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            padding: 6px 12px;
            font-size: 12px;
            cursor: pointer
        }

        .module-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb
        }

        .collapse-section {
            margin-top: 15px;
            border-left: 3px solid #faab41;
            padding-left: 20px
        }

        .collapse-btn {
            background: none;
            border: none;
            color: #faab41;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            padding: 0;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease
        }

        .collapse-btn:hover {
            color: #f6821f
        }

        .success-message,
        .error-message {
            display: none;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            font-weight: 500;
            animation: slideIn 0.3s ease
        }

        .success-message {
            background: linear-gradient(135deg, #10b981 0, #059669 100%);
            color: #fff
        }

        .error-message {
            background: linear-gradient(135deg, #ef4444 0, #dc2626 100%);
            color: #fff
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #faab41;
            border-top-color: transparent;
            border-radius: 50%;
            animation: rotate 0.6s linear infinite
        }

        @media(max-width:768px) {
            .card-container {
                padding: 20px;
                margin: 0
            }

            .header {
                flex-direction: column;
                gap: 15px;
                padding: 20px;
                margin-bottom: 20px
            }

            .module {
                padding: 20px;
                margin-bottom: 20px
            }

            .module .form-group {
                grid-template-columns: 1fr;
                gap: 10px
            }

            .header-buttons {
                width: 100%;
                gap: 10px
            }

            .header-buttons .btn {
                flex: 1
            }
        }

        @media(max-width:480px) {
            .card-container {
                padding: 15px
            }
        }

        @media(max-height:600px) and (orientation:landscape) {
            .card-container {
                padding: 15px
            }
        }

        /* Ëá™ÂÆö‰πâÊåâÈíÆÊ†∑Âºè */
        .btn-reset {
            background: linear-gradient(135deg, #ef4444 0, #dc2626 100%);
            color: #fff;
        }

        .btn-all-logs {
            background: linear-gradient(135deg, #3b82f6 0, #1d4ed8 100%);
            flex-shrink: 0;
        }

        .btn-close-modal {
            width: 100%;
            margin-top: 20px;
        }

        .btn-confirm-reset {
            background: linear-gradient(135deg, #ef4444 0, #dc2626 100%);
            color: #fff;
        }

        .btn-test-api {
            flex: 2;
            background: linear-gradient(135deg, #3b82f6 0, #1d4ed8 100%);
            color: #fff;
        }

        .btn-confirm-api {
            flex: 1;
            opacity: 0.5;
        }

        .btn-confirm-api:not([disabled]) {
            opacity: 1;
        }

        .btn-cancel-api {
            flex: 1;
        }

        .btn-qrcode {
            background: linear-gradient(135deg, #06b6d4 0, #0891b2 100%);
            color: #fff;
            box-shadow: 0 4px 15px rgba(6, 182, 212, 0.4);
        }

        .btn-qrcode:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(6, 182, 212, 0.5);
        }

        .btn-qrcode:active {
            transform: translateY(0);
            box-shadow: 0 2px 10px rgba(6, 182, 212, 0.4);
        }

        /* ÈöêËóèÂÖÉÁ¥† */
        .hidden-section {
            display: none;
        }

        /* Cloudflare ÈÖçÁΩÆÈÉ®ÂàÜÊ†∑Âºè */
        #cloudflareEmailSection,
        #cloudflareAccountIDSection {
            display: none;
        }

        /* QRCode ÂÆπÂô® */
        .qrcode-container {
            margin: 30px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 350px;
        }

        /* ÈáçÁΩÆÈÖçÁΩÆÂºπÁ™ó */
        .reset-modal-title {
            color: #ef4444;
            margin-bottom: 15px;
        }

        .reset-modal-description {
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .reset-modal-confirm {
            color: #ef4444;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .reset-modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: space-between;
        }

        /* Êó•ÂøóÂÆπÂô® */
        .logs-container {
            margin-bottom: 20px;
        }

        .logs-loading {
            text-align: center;
            padding: 20px;
            color: #6b7280;
        }

        .logs-footer {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 20px;
        }

        .logs-footer-text {
            font-size: 12px;
            color: #9ca3af;
            margin: 0;
        }

        /* Êó•ÂøóÊ®°ÊÄÅÊ°Ü */
        .logs-modal {
            overflow-y: auto;
            width: 90vw;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logs-modal-title {
            margin-bottom: 20px;
        }

        .logs-all-container {
            max-height: 70vh;
            overflow-y: auto;
            overflow-x: auto;
        }

        /* ËÆ¢ÈòÖ API ÂºπÁ™ó */
        .subapi-modal-title {
            margin-bottom: 20px;
        }

        .subapi-form-group {
            grid-template-columns: 1fr;
        }

        .subapi-status {
            margin: 15px 0;
            padding: 12px 16px;
            border-radius: 8px;
            display: none;
        }

        .subapi-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        /* ËæìÂÖ•Â≠óÊÆµÁâπÊÆäÊ†∑Âºè */
        .subapi-input {
            cursor: pointer !important;
            background-color: #fff !important;
            color: #1f2937 !important;
        }

        /* ËäÇÁÇπÈìæÊé•ËæìÂÖ•ÂåÖË£ÖÂô® */
        .link-input-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .link-input-field {
            flex: 1;
        }

        /* Ê∂àÊÅØÈÄöÁü•ËÆæÁΩÆÊ†∑Âºè */
        .notification-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px !important;
            padding: 2px 0;
        }

        .notification-row>label:first-child {
            display: flex;
            align-items: center;
            gap: 70px;
            margin: 0 !important;
            white-space: nowrap;
            flex: 1;
        }

        .notification-row>label:first-child .checkbox-group {
            display: flex;
            margin: 0;
            white-space: nowrap;
            gap: 6px;
        }

        .notification-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-left: auto;
            flex-shrink: 0;
        }

        .notification-controls .btn {
            flex-shrink: 0;
            font-size: 14px;
        }

        .btn-notification-config {
            background: linear-gradient(135deg, #8b5cf6 0, #7c3aed 100%);
            color: #fff;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }

        .btn-notification-config::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left .5s ease
        }

        .btn-notification-config:hover::before {
            left: 100%
        }

        .btn-notification-config:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(139, 92, 246, 0.5);
        }

        .btn-notification-config:active {
            transform: translateY(0);
            box-shadow: 0 2px 10px rgba(139, 92, 246, 0.3);
        }

        /* ==================== CF ‰ΩøÁî®ÁªüËÆ°Ê®°ÂùóÊ†∑Âºè ==================== */

        .cf-usage-module {
            display: none;
        }

        .cf-usage-module[style*="display: block"] {
            display: block !important;
        }

        .cf-usage-wrapper {
            padding: 20px 0;
        }

        /* ÁªüËÆ°Âç°Áâá */
        .cf-stats-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(6, 182, 212, 0.1) 100%);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            border-left: 4px solid #3b82f6;
        }

        .cf-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
        }

        .cf-stat-item {
            display: flex;
            flex-direction: column;
        }

        .cf-stat-label {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .cf-stat-value {
            font-size: 24px;
            font-weight: 700;
        }

        .cf-value-green {
            color: #10b981;
        }

        .cf-value-blue {
            color: #3b82f6;
        }

        .cf-value-orange {
            color: #f59e0b;
        }

        .cf-progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .cf-progress-title {
            font-size: 13px;
            font-weight: 600;
            color: #1f2937;
        }

        .cf-percentage-badge {
            font-size: 13px;
            font-weight: 600;
            color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
            padding: 4px 12px;
            border-radius: 20px;
        }

.cf-progress-bar {
    position: relative;
    height: 28px;
    background: linear-gradient(90deg, #9ca3af 0%, #6b7280 100%);
    border-radius: 14px;
    overflow: hidden;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.06);
}        .cf-bar-segment {
            position: absolute;
            height: 100%;
            border-radius: 0;
            width: 0%;
            transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex;
            align-items: center;
            font-size: 11px;
            font-weight: 700;
            color: white;
        }

        .cf-bar-green {
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
            box-shadow: 0 0 12px rgba(16, 185, 129, 0.5);
            justify-content: flex-end;
            padding-right: 12px;
            opacity: 0.9;
        }

        .cf-bar-blue {
            background: linear-gradient(90deg, #3b82f6 0%, #1d4ed8 100%);
            box-shadow: 0 0 12px rgba(59, 130, 246, 0.5);
            justify-content: center;
            opacity: 0.85;
        }

        .cf-percentage-center {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 700;
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        /* ‰ø°ÊÅØÊèêÁ§∫Ê°Ü */
        .cf-info-box {
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.05) 0%, rgba(234, 179, 8, 0.05) 100%);
            border: 1px solid rgba(249, 115, 22, 0.2);
            border-radius: 8px;
            padding: 14px;
            margin-bottom: 0;
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        .cf-info-icon {
            font-size: 16px;
            flex-shrink: 0;
        }

        .cf-info-text {
            font-size: 13px;
            color: #6b7280;
            line-height: 1.6;
        }

        .cf-info-text strong {
            color: #1f2937;
        }

        .cf-highlight {
            color: #f59e0b !important;
        }

        /* ÂÄíËÆ°Êó∂Êï∞Â≠óÊ†∑Âºè */
        .countdown-numbers {
            color: #f59e0b;
            font-weight: bold;
        }

        /* ÂÄíËÆ°Êó∂ÊñáÂ≠óÊ†∑Âºè */
        .countdown-text {
            color: #6b7280;
        }

        /* ÂìçÂ∫îÂºèÂ∏ÉÂ±ÄÔºöÊ°åÈù¢Á´ØÈöêËóèÊç¢Ë°åÁ¨¶ÔºåÁßªÂä®Á´ØÊòæÁ§∫ */
        @media (min-width: 768px) {
            .cf-info-text br {
                display: none;
            }
            .cf-info-text {
                white-space: nowrap;
            }
        }

        @media (max-width: 767px) {
            .cf-info-text br {
                display: block;
            }
            .cf-info-text {
                white-space: normal;
            }
        }

        /* ==================== Ê∑±Ëâ≤Ê®°ÂºèÊîØÊåÅ ==================== */

        html.dark-mode .cf-stats-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(6, 182, 212, 0.2) 100%);
            border-left-color: #3b82f6;
        }

        html.dark-mode .cf-stat-label {
            color: var(--text-secondary);
        }

        html.dark-mode .cf-progress-title {
            color: var(--text-primary);
        }

        html.dark-mode .cf-percentage-badge {
            color: #fbbf24;
            background: rgba(251, 191, 36, 0.1);
        }

html.dark-mode .cf-progress-bar {
    background: linear-gradient(90deg, #111827 0%, #0f172a 100%);
}        html.dark-mode .cf-percentage-center {
            color: white;
        }

        html.dark-mode .cf-info-box {
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.1) 0%, rgba(234, 179, 8, 0.1) 100%);
            border-color: rgba(249, 115, 22, 0.3);
        }

        html.dark-mode .cf-info-text {
            color: var(--text-secondary);
        }

        html.dark-mode .cf-info-text strong {
            color: var(--text-primary);
        }

        html.dark-mode .cf-highlight {
            color: #fbbf24 !important;
        }

        /* Ê∑±Ëâ≤Ê®°ÂºèÂÄíËÆ°Êó∂Êï∞Â≠óÊ†∑Âºè */
        html.dark-mode .countdown-numbers {
            color: #fbbf24;
            font-weight: bold;
        }

        /* Ê∑±Ëâ≤Ê®°ÂºèÂÄíËÆ°Êó∂ÊñáÂ≠óÊ†∑Âºè */
        html.dark-mode .countdown-text {
            color: #9ca3af;
        }
    </style>
</head>

<body>
    <!-- ËÉåÊôØÂÜÖÂÆπ -->
    <iframe id="background-iframe" src="/" title="ËÉåÊôØÂÜÖÂÆπ"></iframe>

    <!-- ÊØõÁéªÁíÉÊïàÊûúÈÅÆÁõñÂ±Ç -->
    <div id="blur-overlay"></div>

    <!-- ÁÆ°ÁêÜÂêéÂè∞ÂÆπÂô® -->
    <div class="page-wrapper">
        <div class="card-container">
            <div class="success-message" id="successMsg"></div>
            <div class="error-message" id="errorMsg"></div>

            <div class="header">
                <div class="header-title">
                    <h1 id="pageTitle">Âä†ËΩΩ‰∏≠...</h1>
                </div>
                <div class="header-buttons">
                    <button type="button" class="btn btn-danger btn-reset" onclick="resetConfigWithConfirm()">‚ö†Ô∏è
                        ÈáçÁΩÆÈÖçÁΩÆ</button>
                    <button type="button" class="btn btn-primary" onclick="logout()">üëã ÈÄÄÂá∫ÁôªÂΩï</button>
                </div>
            </div>

            <!-- Cloudflare Workers/Pages ‰ΩøÁî®ÁªüËÆ°Ê®°Âùó -->
            <div class="module cf-usage-module collapsed" id="cfUsageModule">
                <div class="module-title" onclick="toggleModule(this)">
                    Workers/Pages ËØ∑Ê±Ç‰ΩøÁî®ÊÉÖÂÜµ
                    <svg class="collapse-icon" viewBox="0 0 24 24">
                        <path d="M7 10l5 5 5-5z" />
                    </svg>
                </div>
                <!-- ËøõÂ∫¶Êù° -->
                <div>
                    <div class="cf-progress-bar">
                        <!-- Workers ËøõÂ∫¶Êù° (ÁªøËâ≤) -->
                        <div class="cf-bar-segment cf-bar-green" id="cfWorkerBar" title="Workers ËØ∑Ê±Ç"></div>
                        <!-- Pages ËøõÂ∫¶Êù° (ËìùËâ≤) -->
                        <div class="cf-bar-segment cf-bar-blue" id="cfPagesBar" title="Pages ËØ∑Ê±Ç"></div>
                        <!-- ÊÄª‰ΩìÁôæÂàÜÊØîÊñáÂ≠ó (‰∏≠Â§Æ) -->
                        <div class="cf-percentage-center" id="cfPercentageCenter">0%</div>
                    </div>
                </div>
                <div class="module-content">
                    <div class="cf-usage-wrapper">
                        <!-- ‰ΩøÁî®ÁªüËÆ°Âç°Áâá -->
                        <div class="cf-stats-card">
                            <div class="cf-stats-grid">
                                <div class="cf-stat-item">
                                    <div class="cf-stat-label">Workers ËØ∑Ê±Ç</div>
                                    <div class="cf-stat-value cf-value-green" id="cfWorkerCount">-</div>
                                </div>
                                <div class="cf-stat-item">
                                    <div class="cf-stat-label">Pages ËØ∑Ê±Ç</div>
                                    <div class="cf-stat-value cf-value-blue" id="cfPagesCount">-</div>
                                </div>
                                <div class="cf-stat-item">
                                    <div class="cf-stat-label">Êó•ÈÖçÈ¢ù</div>
                                    <div class="cf-stat-value cf-value-orange">100,000</div>
                                </div>
                            </div>
                        </div>

                        <!-- ‰ø°ÊÅØÊèêÁ§∫ -->
                        <div class="cf-info-box">
                            <div class="cf-info-icon">‚ÑπÔ∏è</div>
                            <div class="cf-info-text">
                                <strong>ÊØèÊó•ËØ∑Ê±ÇÊï∞ÈáçÁΩÆÊ∏ÖÈõ∂Ôºö</strong><br><span id="countdown" class="cf-highlight">Ë∑ùÁ¶ªÈáçÁΩÆÊó∂Èó¥ËøòÊúâ 15Â∞èÊó∂ 24ÂàÜ 34Áßí</span>Ôºå<br>Âåó‰∫¨Êó∂Èó¥ (UTC+8) ÊØèÂ§© <strong class="cf-highlight">8:00</strong>ÈáçÁΩÆ<br>Ôºå‰ªäÊó•‰ΩøÁî®ÊÉÖÂÜµÊÄªËÆ°Ôºö<strong class="cf-highlight" id="cfTotalDisplay">-</strong>„ÄÇ
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ê®°Âùó1: ËÆ¢ÈòÖÈìæÊé• -->
            <div class="module">
                <div class="module-title" onclick="toggleModule(this)">
                    üìã Ëé∑ÂèñËäÇÁÇπÈìæÊé•
                    <svg class="collapse-icon" viewBox="0 0 24 24">
                        <path d="M7 10l5 5 5-5z" />
                    </svg>
                </div>
                <div class="form-group">
                    <label for="LinkURL">ËäÇÁÇπÈìæÊé•Ê†ºÂºè</label>
                    <div class="input-wrapper">
                        <input type="text" id="LinkURL" title="ËäÇÁÇπÈìæÊé•Ê†ºÂºè" readonly>
                        <button type="button" class="btn btn-qrcode" onclick="showQRCode('LinkURL')">üì±‰∫åÁª¥Á†Å</button>
                        <button type="button" class="btn btn-primary"
                            onclick="copySubscription('LinkURL')">Â§çÂà∂ËäÇÁÇπ</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="subLink">Ëá™ÈÄÇÂ∫îËÆ¢ÈòÖ</label>
                    <div class="input-wrapper">
                        <input type="text" id="subLink" title="Ëá™ÈÄÇÂ∫îËÆ¢ÈòÖ" readonly>
                        <button type="button" class="btn btn-qrcode" onclick="showQRCode('subLink')">üì±‰∫åÁª¥Á†Å</button>
                        <button type="button" class="btn btn-primary"
                            onclick="copySubscription('subLink')">Â§çÂà∂ËÆ¢ÈòÖ</button>
                    </div>
                </div>
                <div class="module-content">
                    <div class="form-group">
                        <label for="clashLink">ClashËÆ¢ÈòÖ</label>
                        <div class="input-wrapper">
                            <input type="text" id="clashLink" title="ClashËÆ¢ÈòÖ" readonly>
                            <button type="button" class="btn btn-qrcode"
                                onclick="showQRCode('clashLink')">üì±‰∫åÁª¥Á†Å</button>
                            <button type="button" class="btn btn-primary"
                                onclick="copySubscription('clashLink')">Â§çÂà∂ËÆ¢ÈòÖ</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="singboxLink">SingBoxËÆ¢ÈòÖ</label>
                        <div class="input-wrapper">
                            <input type="text" id="singboxLink" title="SingBoxËÆ¢ÈòÖ" readonly>
                            <button type="button" class="btn btn-qrcode"
                                onclick="showQRCode('singboxLink')">üì±‰∫åÁª¥Á†Å</button>
                            <button type="button" class="btn btn-primary"
                                onclick="copySubscription('singboxLink')">Â§çÂà∂ËÆ¢ÈòÖ</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ê®°Âùó2: ÁºñËæëËÆ¢ÈòÖÁîüÊàê -->
            <div class="module collapsed">
                <div class="module-title" onclick="toggleModule(this)">
                    ‚ö°Ô∏è ‰ºòÈÄâËÆ¢ÈòÖÁîüÊàê
                    <svg class="collapse-icon" viewBox="0 0 24 24">
                        <path d="M7 10l5 5 5-5z" />
                    </svg>
                </div>
                <div class="module-content">

                    <div class="form-group">
                        <label for="ipMode">‰ºòÈÄâËÆ¢ÈòÖÊ®°Âºè</label>
                        <select id="ipMode" title="‰ºòÈÄâËÆ¢ÈòÖÊ®°Âºè" onchange="updateIPMode()">
                            <option value="random">ÈöèÊú∫‰ºòÈÄâ</option>
                            <option value="custom">Ëá™ÂÆö‰πâ‰ºòÈÄâ</option>
                            <option value="generator">‰ºòÈÄâËÆ¢ÈòÖÁîüÊàêÂô®</option>
                        </select>
                    </div>

                    <div id="randomIPSection" class="form-group">
                        <label for="randomCount">ÈöèÊú∫‰ºòÈÄâÊï∞Èáè</label>
                        <input type="number" id="randomCount" title="ÈöèÊú∫‰ºòÈÄâÊï∞Èáè" min="1" max="999" value="16"
                            onchange="markModified('sub')">
                    </div>

                    <div id="customIPSection" class="form-group hidden-section">
                        <label for="customIPs">Ëá™ÂÆö‰πâ‰ºòÈÄâÂú∞ÂùÄ</label>
                        <textarea id="customIPs" title="Ëá™ÂÆö‰πâ‰ºòÈÄâÂú∞ÂùÄ" placeholder="ÊØèË°å‰∏Ä‰∏™Âú∞ÂùÄÔºåÊ†ºÂºè: IP[:Á´ØÂè£]#Â§áÊ≥®"
                            onchange="markModified('sub')"></textarea>
                    </div>

                    <div id="generatorSection" class="form-group hidden-section">
                        <label for="generatorURL">‰ºòÈÄâËÆ¢ÈòÖÁîüÊàêÂô®</label>
                        <input type="text" id="generatorURL" title="‰ºòÈÄâËÆ¢ÈòÖÁîüÊàêÂô®" placeholder="sub.cmliussss.net"
                            onchange="processGeneratorURL()" oninput="processGeneratorURL()">
                    </div>

                    <div class="module-footer">
                        <div class="btn-group">
                            <button type="button" class="btn btn-secondary" onclick="cancelEdit('sub')" disabled
                                id="cancelSubBtn">ÂèñÊ∂à</button>
                            <button type="button" class="btn btn-primary" onclick="saveSub()" disabled
                                id="saveSubBtn">‰øùÂ≠ò</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ê®°Âùó3: ËØ¶ÁªÜÈÖçÁΩÆ‰ø°ÊÅØ -->
            <div class="module collapsed">
                <div class="module-title" onclick="toggleModule(this)">
                    ‚öôÔ∏è ËØ¶ÁªÜÈÖçÁΩÆ‰ø°ÊÅØ
                    <svg class="collapse-icon" viewBox="0 0 24 24">
                        <path d="M7 10l5 5 5-5z" />
                    </svg>
                </div>
                <div class="module-content">

                    <div class="form-group">
                        <label for="subName">ËÆ¢ÈòÖÂêçÁß∞</label>
                        <input type="text" id="subName" title="ËÆ¢ÈòÖÂêçÁß∞" onchange="markModified('config')">
                    </div>

                    <div class="form-group">
                        <label for="nodeHost">ËäÇÁÇπÂüüÂêç</label>
                        <input type="text" id="nodeHost" title="ËäÇÁÇπÂüüÂêç" readonly>
                    </div>

                    <div class="form-group">
                        <label for="nodeUUID">UUID</label>
                        <input type="text" id="nodeUUID" title="UUID" readonly>
                    </div>

                    <div class="form-group">
                        <label for="protocol">ËäÇÁÇπÂçèËÆÆ</label>
                        <select id="protocol" title="ËäÇÁÇπÂçèËÆÆ" onchange="updateProtocol(); markModified('config')">
                            <option value="vless">VLESS</option>
                            <option value="trojan">Trojan</option>
                        </select>
                    </div>
                    <!--- ËäÇÁÇπÈÖçÁΩÆ 
                <div class="form-group">
                    <label>‰º†ËæìÂçèËÆÆ</label>
                    <select id="transport" onchange="markModified('config')">
                        <option value="ws">WebSocket</option>
                        <option value="xhttp">XHTTP</option>
                    </select>
                </div>
                --->
                    <div class="form-group">
                        <label for="skipVerify">Ë∑≥ËøáËØÅ‰π¶È™åËØÅ</label>
                        <div class="input-wrapper">
                            <div class="checkbox-group">
                                <input type="checkbox" id="skipVerify" title="Ë∑≥ËøáËØÅ‰π¶È™åËØÅ" onchange="markModified('config')">
                                <label for="skipVerify" class="checkbox-label">ÂêØÁî®</label>
                            </div>
                        </div>
                    </div>

                    <div class="module-footer">
                        <div class="btn-group">
                            <button type="button" class="btn btn-secondary" onclick="cancelEdit('config')" disabled
                                id="cancelConfigBtn">ÂèñÊ∂à</button>
                            <button type="button" class="btn btn-primary" onclick="saveConfig()" disabled
                                id="saveConfigBtn">‰øùÂ≠ò</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ê®°Âùó4: Âèç‰ª£ËêΩÂú∞ËÆæÁΩÆ -->
            <div class="module collapsed">
                <div class="module-title" onclick="toggleModule(this)">
                    üåê Cloudflare CDN ËÆøÈóÆËÆæÁΩÆ
                    <svg class="collapse-icon" viewBox="0 0 24 24">
                        <path d="M7 10l5 5 5-5z" />
                    </svg>
                </div>
                <div class="module-content">

                    <div class="form-group">
                        <label for="proxyMode">Âèç‰ª£Ê®°Âºè</label>
                        <select id="proxyMode" title="Âèç‰ª£Ê®°Âºè" onchange="updateProxyMode()">
                            <option value="auto">PROXYIP</option>
                            <option value="socks5">SOCKS5</option>
                            <option value="http">HTTP</option>
                        </select>
                    </div>

                    <div id="proxyIPSection" class="form-group">
                        <div class="form-group">
                            <label for="proxyIP">PROXYIP</label>
                            <div class="input-wrapper">
                                <input type="text" id="proxyIP" title="PROXYIP" placeholder="proxyip.cmliussss.net"
                                    onchange="processProxyIP()" oninput="processProxyIP()">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="autoProxy" title="ÂêØÁî®Ëá™Âä®Ëé∑Âèñ"
                                        onchange="toggleAutoProxy(); markModified('proxy')">
                                    <label for="autoProxy" class="checkbox-label">ÂêØÁî®Ëá™Âä®Ëé∑Âèñ</label>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div id="socks5Section" class="hidden-section">
                        <div class="form-group">
                            <label for="socks5Addr">SOCKS5</label>
                            <div class="input-wrapper">
                                <input type="text" id="socks5Addr" title="SOCKS5"
                                    placeholder="user:password@127.0.0.1:1080" onchange="processProxyAddress('socks5')"
                                    oninput="processProxyAddress('socks5')">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="globalSocks5" title="ÂêØÁî®ÂÖ®Â±Ä‰ª£ÁêÜ"
                                        onchange="markModified('proxy')">
                                    <label for="globalSocks5" class="checkbox-label">ÂêØÁî®ÂÖ®Â±Ä‰ª£ÁêÜ</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="httpSection" class="hidden-section">
                        <div class="form-group">
                            <label for="httpAddr">HTTP</label>
                            <div class="input-wrapper">
                                <input type="text" id="httpAddr" title="HTTP" placeholder="user:password@127.0.0.1:8080"
                                    onchange="processProxyAddress('http')" oninput="processProxyAddress('http')">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="globalHTTP" title="ÂêØÁî®ÂÖ®Â±Ä‰ª£ÁêÜ"
                                        onchange="markModified('proxy')">
                                    <label for="globalHTTP" class="checkbox-label">ÂêØÁî®ÂÖ®Â±Ä‰ª£ÁêÜ</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="module-footer">
                        <div class="btn-group">
                            <button type="button" class="btn btn-secondary" onclick="cancelEdit('proxy')" disabled
                                id="cancelProxyBtn">ÂèñÊ∂à</button>
                            <button type="button" class="btn btn-primary" onclick="saveProxy()" disabled
                                id="saveProxyBtn">‰øùÂ≠ò</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ê®°Âùó5: ËÆ¢ÈòÖËΩ¨Êç¢ÈÖçÁΩÆ -->
            <div class="module collapsed">
                <div class="module-title" onclick="toggleModule(this)">
                    üîÑ ËÆ¢ÈòÖËΩ¨Êç¢ÈÖçÁΩÆ
                    <svg class="collapse-icon" viewBox="0 0 24 24">
                        <path d="M7 10l5 5 5-5z" />
                    </svg>
                </div>
                <div class="module-content">

                    <div class="form-group">
                        <label for="subAPI">ËÆ¢ÈòÖËΩ¨Êç¢ÂêéÁ´Ø</label>
                        <div class="readonly-wrapper" onclick="openSubAPIModal()">
                            <input type="text" id="subAPI" title="ËÆ¢ÈòÖËΩ¨Êç¢ÂêéÁ´Ø" readonly
                                placeholder="https://SUBAPI.cmliussss.net" class="subapi-input">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="subConfig">ËÆ¢ÈòÖËΩ¨Êç¢ÈÖçÁΩÆÊñá‰ª∂</label>
                        <input type="text" id="subConfig" title="ËÆ¢ÈòÖËΩ¨Êç¢ÈÖçÁΩÆÊñá‰ª∂"
                            placeholder="https://raw.githubusercontent.com/..." onchange="markModified('convert')">
                    </div>

                    <div class="form-group">
                        <label for="emoji">Emoji</label>
                        <div class="input-wrapper">
                            <div class="checkbox-group">
                                <input type="checkbox" id="emoji" title="ÂêØÁî®Emoji" onchange="markModified('convert')">
                                <label for="emoji" class="checkbox-label">ÂêØÁî®</label>
                            </div>
                        </div>
                    </div>

                    <div class="module-footer">
                        <div class="btn-group">
                            <button type="button" class="btn btn-secondary" onclick="cancelEdit('convert')" disabled
                                id="cancelConvertBtn">ÂèñÊ∂à</button>
                            <button type="button" class="btn btn-primary" onclick="saveConvert()" disabled
                                id="saveConvertBtn">‰øùÂ≠ò</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ê®°Âùó6: Ê∂àÊÅØÈÄöÁü•ËÆæÁΩÆ -->
            <div class="module collapsed">
                <div class="module-title" onclick="toggleModule(this)">
                    üîî Ê∂àÊÅØÈÄöÁü•ËÆæÁΩÆ
                    <svg class="collapse-icon" viewBox="0 0 24 24">
                        <path d="M7 10l5 5 5-5z" />
                    </svg>
                </div>
                <div class="module-content">

                    <!-- Telegram Bot ÈÄöÁü•ËÆæÁΩÆ -->
                    <div class="form-group notification-row">
                        <label>
                            Telegram Bot ÈÄöÁü•ËÆæÁΩÆ
                            <div class="checkbox-group">
                                <input type="checkbox" id="telegramEnabled" title="ÂêØÁî®TelegramBotÈÄöÁü•"
                                    onchange="markModified('notification')" disabled>
                                <label for="telegramEnabled" class="checkbox-label">ÂêØÁî®</label>
                            </div>
                        </label>
                        <div class="notification-controls">
                            <button type="button" class="btn btn-notification-config"
                                onclick="openTelegramConfigModal()">‚öôÔ∏è ÈÄöÁü•ÂèÇÊï∞ÈÖçÁΩÆ</button>
                        </div>
                    </div>

                    <!-- Cloudflare ÂèØÁî®ËØ∑Ê±ÇÊï∞ÁªüËÆ° -->
                    <div class="form-group notification-row">
                        <label>
                            Cloudflare Workers/Pages ÂèØÁî®ËØ∑Ê±ÇÊï∞ÁªüËÆ°
                        </label>
                        <div class="notification-controls">
                            <button type="button" class="btn btn-notification-config"
                                onclick="openCloudflareConfigModal()">‚öôÔ∏è ÈÄöÁü•ÂèÇÊï∞ÈÖçÁΩÆ</button>
                        </div>
                    </div>

                    <div class="module-footer">
                        <div class="btn-group">
                            <button type="button" class="btn btn-secondary" onclick="cancelEdit('notification')"
                                disabled id="cancelNotificationBtn">ÂèñÊ∂à</button>
                            <button type="button" class="btn btn-primary" onclick="saveNotification()" disabled
                                id="saveNotificationBtn">‰øùÂ≠ò</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ê®°Âùó7: Êü•ÁúãÊâÄÊúâÊó•Âøó -->
            <div class="module collapsed">
                <div class="module-title" onclick="toggleModule(this); loadLogsOnExpand(this)">
                    üìã Êü•ÁúãÊìç‰ΩúÊó•Âøó
                    <svg class="collapse-icon" viewBox="0 0 24 24">
                        <path d="M7 10l5 5 5-5z" />
                    </svg>
                </div>
                <div class="module-content">
                    <div id="logsContainer" class="logs-container">
                        <div class="logs-loading">Âä†ËΩΩ‰∏≠...</div>
                    </div>
                    <div class="logs-footer">
                        <p class="logs-footer-text">Âõ†‰∏∫KVÁ©∫Èó¥ÊúâÈôêÔºåÊâÄ‰ª•Âè™‰øùÁïô4MBÁöÑÊìç‰ΩúÊó•ÂøóÔºåÂΩìÊó•ÂøóÂ§ßÂ∞èË∂ÖËøáËØ•ÂÆπÈáè‰ºöËá™Âä®Ê∏ÖÁêÜÊúÄËÄÅÁöÑÊó•ÂøóËÆ∞ÂΩï„ÄÇ</p>
                        <button type="button" class="btn btn-primary btn-all-logs" onclick="showAllLogs()">ÂÖ®ÈÉ®Êó•Âøó</button>
                    </div>
                </div>
            </div>

            <div class="social-links">
                <a href="https://github.com/cmliu/edgetunnel" target="_blank" rel="noopener" class="social-link"
                    title="GitHub">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
                        <path fill="currentColor" fill-rule="evenodd"
                            d="M7.976 0A7.977 7.977 0 0 0 0 7.976c0 3.522 2.3 6.507 5.431 7.584c.392.049.538-.196.538-.392v-1.37c-2.201.49-2.69-1.076-2.69-1.076c-.343-.93-.881-1.175-.881-1.175c-.734-.489.048-.489.048-.489c.783.049 1.224.832 1.224.832c.734 1.223 1.859.88 2.3.685c.048-.538.293-.88.489-1.076c-1.762-.196-3.621-.881-3.621-3.964c0-.88.293-1.566.832-2.153c-.05-.147-.343-.978.098-2.055c0 0 .685-.196 2.201.832c.636-.196 1.322-.245 2.007-.245s1.37.098 2.006.245c1.517-1.027 2.202-.832 2.202-.832c.44 1.077.146 1.908.097 2.104a3.16 3.16 0 0 1 .832 2.153c0 3.083-1.86 3.719-3.62 3.915c.293.244.538.733.538 1.467v2.202c0 .196.146.44.538.392A7.98 7.98 0 0 0 16 7.976C15.951 3.572 12.38 0 7.976 0"
                            clip-rule="evenodd" />
                    </svg>
                </a>
                <a href="https://t.me/CMLiussss" target="_blank" rel="noopener" class="social-link" title="Telegram">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256">
                        <defs>
                            <linearGradient id="telegramGradient" x1="50%" x2="50%" y1="0%" y2="100%">
                                <stop offset="0%" stop-color="#2AABEE" />
                                <stop offset="100%" stop-color="#229ED9" />
                            </linearGradient>
                        </defs>
                        <path fill="url(#telegramGradient)"
                            d="M128 0C94.06 0 61.48 13.494 37.5 37.49A128.04 128.04 0 0 0 0 128c0 33.934 13.5 66.514 37.5 90.51C61.48 242.506 94.06 256 128 256s66.52-13.494 90.5-37.49c24-23.996 37.5-56.576 37.5-90.51s-13.5-66.514-37.5-90.51C194.52 13.494 161.94 0 128 0" />
                        <path fill="#FFF"
                            d="M57.94 126.648q55.98-24.384 74.64-32.152c35.56-14.786 42.94-17.354 47.76-17.441c1.06-.017 3.42.245 4.96 1.49c1.28 1.05 1.64 2.47 1.82 3.467c.16.996.38 3.266.2 5.038c-1.92 20.24-10.26 69.356-14.5 92.026c-1.78 9.592-5.32 12.808-8.74 13.122c-7.44.684-13.08-4.912-20.28-9.63c-11.26-7.386-17.62-11.982-28.56-19.188c-12.64-8.328-4.44-12.906 2.76-20.386c1.88-1.958 34.64-31.748 35.26-34.45c.08-.338.16-1.598-.6-2.262c-.74-.666-1.84-.438-2.64-.258c-1.14.256-19.12 12.152-54 35.686c-5.1 3.508-9.72 5.218-13.88 5.128c-4.56-.098-13.36-2.584-19.9-4.708c-8-2.606-14.38-3.984-13.82-8.41c.28-2.304 3.46-4.662 9.52-7.072" />
                    </svg>
                </a>
                <button type="button" class="social-link theme-toggle" id="themeToggle" title="ÂàáÊç¢Â§úÈó¥Ê®°Âºè"
                    onclick="toggleTheme()">
                    <!-- Â§™Èò≥ÂõæÊ†á (Êó•Èó¥Ê®°ÂºèÊòæÁ§∫) -->
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="theme-icon sun-icon">
                        <circle cx="12" cy="12" r="5" fill="currentColor" />
                        <g stroke="currentColor" stroke-width="2" stroke-linecap="round" fill="none">
                            <line x1="12" y1="1" x2="12" y2="3" />
                            <line x1="12" y1="21" x2="12" y2="23" />
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
                            <line x1="1" y1="12" x2="3" y2="12" />
                            <line x1="21" y1="12" x2="23" y2="12" />
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
                        </g>
                    </svg>
                    <!-- Êúà‰∫ÆÂõæÊ†á (Â§úÈó¥Ê®°ÂºèÊòæÁ§∫) -->
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="theme-icon moon-icon">
                        <path fill="currentColor" d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- ‰∫åÁª¥Á†ÅÂºπÁ™ó -->
    <div class="modal-overlay" id="qrcodeModal" onclick="closeQRCode(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <button type="button" class="modal-close" onclick="closeQRCode()">√ó</button>
            <div id="qrcodeContainer" class="qrcode-container"></div>
            <button type="button" class="btn btn-primary btn-close-modal" onclick="closeQRCode()">ÂÖ≥Èó≠</button>
        </div>
    </div>

    <!-- ÈáçÁΩÆÈÖçÁΩÆÁ°ÆËÆ§ÂºπÁ™ó -->
    <div class="modal-overlay" id="resetModal" onclick="closeResetModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <h2 class="reset-modal-title">‚ö†Ô∏è ÈáçÁΩÆÈÖçÁΩÆ</h2>
            <p class="reset-modal-description">ÈáçÁΩÆÈÖçÁΩÆÂ∞Ü‰ºöÂàùÂßãÂåñÊâÄÊúâËÆæÁΩÆÔºåÂåÖÊã¨ËÆ¢ÈòÖÁîüÊàê„ÄÅËäÇÁÇπ‰ø°ÊÅØ„ÄÅÂèç‰ª£ÈÖçÁΩÆÁ≠â„ÄÇÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄÔºåËØ∑Ë∞®ÊÖéÊìç‰Ωú„ÄÇ</p>
            <p class="reset-modal-confirm">Á°ÆÂÆöÊòØÂê¶ÂÆåÂÖ®ÈáçÁΩÆÈÖçÁΩÆÔºü</p>
            <div class="reset-modal-buttons">
                <button type="button" class="btn btn-primary btn-confirm-reset" onclick="confirmReset()">Á°ÆÂÆöÈáçÁΩÆ</button>
                <button type="button" class="btn btn-secondary" onclick="closeResetModal()">ÂèñÊ∂àÈáçÁΩÆ</button>
            </div>
        </div>
    </div>

    <!-- Êó•ÂøóÊü•ÁúãÂºπÁ™ó -->
    <div class="modal-overlay" id="logsModal" onclick="closeLogsModal(event)">
        <div class="modal logs-modal" onclick="event.stopPropagation()">
            <button type="button" class="modal-close" onclick="closeLogsModal()">√ó</button>
            <h2 class="logs-modal-title">üìã ÊâÄÊúâÊìç‰ΩúÊó•Âøó</h2>
            <div id="allLogsContainer" class="logs-all-container"></div>
            <button type="button" class="btn btn-primary btn-close-modal" onclick="closeLogsModal()">ÂÖ≥Èó≠</button>
        </div>
    </div>

    <!-- ËÆ¢ÈòÖËΩ¨Êç¢ÂêéÁ´ØËÆæÁΩÆÂºπÁ™ó -->
    <div class="modal-overlay" id="subAPIModal" onclick="closeSubAPIModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <button type="button" class="modal-close" onclick="closeSubAPIModal()">√ó</button>
            <h2 class="subapi-modal-title">‚öôÔ∏è ËÆ¢ÈòÖËΩ¨Êç¢ÂêéÁ´Ø</h2>
            <div class="form-group subapi-form-group">
                <label>ËÆ¢ÈòÖËΩ¨Êç¢ÂêéÁ´ØÂú∞ÂùÄ</label>
                <input type="text" id="testSubAPIInput" placeholder="ËæìÂÖ•ËÆ¢ÈòÖËΩ¨Êç¢ÂêéÁ´ØÂú∞ÂùÄ">
            </div>
            <div id="subAPIStatus" class="subapi-status"></div>
            <div class="subapi-buttons">
                <button type="button" class="btn btn-primary btn-test-api" onclick="testSubAPI()">ÂèØÁî®ÊÄßÈ™åËØÅ</button>
                <button type="button" class="btn btn-primary btn-confirm-api" id="subAPIConfirmBtn"
                    onclick="confirmSubAPI()" disabled>Á°ÆÂÆö</button>
                <button type="button" class="btn btn-secondary btn-cancel-api" onclick="closeSubAPIModal()">ÂèñÊ∂à</button>
            </div>
        </div>
    </div>

    <!-- TelegramBot ÈÄöÁü•ËÆæÁΩÆÂºπÁ™ó -->
    <div class="modal-overlay" id="telegramConfigModal" onclick="closeTelegramConfigModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <button type="button" class="modal-close" onclick="closeTelegramConfigModal()">√ó</button>
            <h2 class="subapi-modal-title">ü§ñ TelegramBot ÈÄöÁü•ÂèÇÊï∞ÈÖçÁΩÆ</h2>
            <div class="form-group subapi-form-group">
                <label>Bot Token</label>
                <input type="text" id="telegramBotToken" placeholder="ËæìÂÖ•Telegram Bot Token">
            </div>
            <div class="form-group subapi-form-group">
                <label>Chat ID</label>
                <input type="text" id="telegramChatID" placeholder="ËæìÂÖ•Chat ID">
            </div>
            <div id="telegramStatus" class="subapi-status"></div>
            <div class="subapi-buttons">
                <button type="button" class="btn btn-primary btn-test-api" onclick="testTelegramConfig()">ÂèØÁî®ÊÄßÈ™åËØÅ</button>
                <button type="button" class="btn btn-primary btn-confirm-api" id="telegramConfirmBtn"
                    onclick="confirmTelegramConfig()" disabled>‰øùÂ≠ò</button>
                <button type="button" class="btn btn-secondary btn-cancel-api"
                    onclick="closeTelegramConfigModal()">ÂèñÊ∂à</button>
            </div>
        </div>
    </div>

    <!-- Cloudflare ÈÄöÁü•ËÆæÁΩÆÂºπÁ™ó -->
    <div class="modal-overlay" id="cloudflareConfigModal" onclick="closeCloudflareConfigModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <button type="button" class="modal-close" onclick="closeCloudflareConfigModal()">√ó</button>
            <h2 class="subapi-modal-title">‚òÅÔ∏è Workers/Pages ÂèØÁî®ËØ∑Ê±ÇÊï∞ÁªüËÆ°</h2>

            <!-- ËØ∑Ê±ÇÊñπÊ°àÈÄâÊã© -->
            <div class="form-group subapi-form-group">
                <label>ËØ∑Ê±ÇÊñπÊ°à</label>
                <select id="cloudflareAuthMethod" title="ËØ∑Ê±ÇÊñπÊ°à" onchange="updateCloudflareAuthMethod()">
                    <option value="email">Email + Global API Key</option>
                    <option value="accountid">Account ID + API Token</option>
                </select>
            </div>

            <!-- Email + Global API Key ÊñπÊ°à -->
            <div id="cloudflareEmailSection">
                <div class="form-group subapi-form-group">
                    <label>Email</label>
                    <input type="text" id="cloudflareEmail" placeholder="ËæìÂÖ•CloudflareË¥¶Êà∑ÈÇÆÁÆ±">
                </div>
                <div class="form-group subapi-form-group">
                    <label>Global API Key</label>
                    <input type="password" id="cloudflareGlobalAPIKey" placeholder="ËæìÂÖ•Global API Key">
                </div>
            </div>

            <!-- Account ID + API Token ÊñπÊ°à -->
            <div id="cloudflareAccountIDSection" class="hidden-section">
                <div class="form-group subapi-form-group">
                    <label>Account ID</label>
                    <input type="text" id="cloudflareAccountID" placeholder="ËæìÂÖ•Account ID">
                </div>
                <div class="form-group subapi-form-group">
                    <label>API Token</label>
                    <input type="password" id="cloudflareAPIToken" placeholder="ËæìÂÖ•API Token">
                </div>
            </div>

            <!-- È™åËØÅÁä∂ÊÄÅÊèêÁ§∫ -->
            <div id="cloudflareStatus" class="subapi-status"></div>

            <!-- ÊåâÈíÆÁªÑ -->
            <div class="subapi-buttons">
                <button type="button" class="btn btn-primary btn-test-api"
                    onclick="testCloudflareConfig()">ÂèØÁî®ÊÄßÈ™åËØÅ</button>
                <button type="button" class="btn btn-primary btn-confirm-api" id="cloudflareConfirmBtn"
                    onclick="confirmCloudflareConfig()" disabled>‰øùÂ≠ò</button>
                <button type="button" class="btn btn-secondary btn-cancel-api"
                    onclick="closeCloudflareConfigModal()">ÂèñÊ∂à</button>
            </div>
        </div>
    </div>

    <script>
        let currentConfig = {};
        let originalConfig = {};
        let modifiedSections = new Set();

        // ÂàùÂßãÂåñ‰∏ªÈ¢ò
        function initializeTheme() {
            const saved = localStorage.getItem('theme');
            let theme = saved;

            // Â¶ÇÊûúÁ¨¨‰∏ÄÊ¨°ÊâìÂºÄÔºåÊåâÁ≥ªÁªü‰∏ªÈ¢òÂÜ≥ÂÆö
            if (!saved) {
                theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            }

            applyTheme(theme);
        }

        // Â∫îÁî®‰∏ªÈ¢ò
        function applyTheme(theme) {
            if (theme === 'dark') {
                document.documentElement.classList.add('dark-mode');
                localStorage.setItem('theme', 'dark');
            } else {
                document.documentElement.classList.remove('dark-mode');
                localStorage.setItem('theme', 'light');
            }
        }

        // ÂàáÊç¢‰∏ªÈ¢ò
        function toggleTheme() {
            const isDark = document.documentElement.classList.contains('dark-mode');
            applyTheme(isDark ? 'light' : 'dark');
        }

        async function loadConfig() {
            try {
                const response = await fetch('/admin/config.json?t=' + Date.now());
                if (!response.ok) throw new Error('Âä†ËΩΩÈÖçÁΩÆÂ§±Ë¥•');
                currentConfig = await response.json();
                originalConfig = JSON.parse(JSON.stringify(currentConfig));
                renderUI();
                // ËÆæÁΩÆÁΩëÈ°µÊ†áÈ¢ò
                document.title = `${currentConfig.‰ºòÈÄâËÆ¢ÈòÖÁîüÊàê?.SUBNAME || 'edgetunnel'}ËÆæÁΩÆÈ°µÈù¢ - ÁÆ°ÁêÜÂêéÂè∞`;
            } catch (error) {
                showToast('Âä†ËΩΩÈÖçÁΩÆÂ§±Ë¥•: ' + error.message, 'error');
            }
        }

        function renderUI() {
            // Ê†áÈ¢ò
            document.getElementById('pageTitle').textContent = (currentConfig.‰ºòÈÄâËÆ¢ÈòÖÁîüÊàê?.SUBNAME || 'edgetunnel') + 'ËÆæÁΩÆÈ°µÈù¢';

            // Ê£ÄÊü• CF ‰ΩøÁî®ÊÉÖÂÜµÂπ∂ÊòæÁ§∫Ê®°Âùó
            const cfUsageModule = document.getElementById('cfUsageModule');
            const cfUsage = currentConfig.CF?.Usage;
            if (cfUsage && cfUsage.success) {
                cfUsageModule.style.display = 'block';
                cfUsageModule.classList.remove('cf-usage-module');
                updateCFUsageDisplay(cfUsage);
            } else {
                cfUsageModule.style.display = 'none';
                cfUsageModule.classList.add('cf-usage-module');
            }

            // ËÆ¢ÈòÖÈìæÊé•
            const token = currentConfig.‰ºòÈÄâËÆ¢ÈòÖÁîüÊàê?.TOKEN;
            const host = currentConfig.HOST;
            const link = currentConfig.LINK;
            document.getElementById('LinkURL').value = currentConfig.LINK;
            document.getElementById('subLink').value = `https://${host}/sub?token=${token}`;
            document.getElementById('clashLink').value = `https://${host}/sub?token=${token}&clash`;
            document.getElementById('singboxLink').value = `https://${host}/sub?token=${token}&sb`;

            // ÁºñËæëËÆ¢ÈòÖÁîüÊàê
            const local = currentConfig.‰ºòÈÄâËÆ¢ÈòÖÁîüÊàê?.local ?? true;
            const randomIP = currentConfig.‰ºòÈÄâËÆ¢ÈòÖÁîüÊàê?.Êú¨Âú∞IPÂ∫ì?.ÈöèÊú∫IP ?? true;

            if (!local) {
                document.getElementById('ipMode').value = 'generator';
                document.getElementById('generatorURL').value = currentConfig.‰ºòÈÄâËÆ¢ÈòÖÁîüÊàê?.SUB || '';
            } else if (randomIP) {
                document.getElementById('ipMode').value = 'random';
                document.getElementById('randomCount').value = currentConfig.‰ºòÈÄâËÆ¢ÈòÖÁîüÊàê?.Êú¨Âú∞IPÂ∫ì?.ÈöèÊú∫Êï∞Èáè || 16;
            } else {
                document.getElementById('ipMode').value = 'custom';
                loadCustomIPs();
            }
            updateIPMode();

            // ËØ¶ÁªÜÈÖçÁΩÆ
            document.getElementById('subName').value = currentConfig.‰ºòÈÄâËÆ¢ÈòÖÁîüÊàê?.SUBNAME || '';
            document.getElementById('nodeHost').value = currentConfig.HOST || '';
            document.getElementById('nodeUUID').value = currentConfig.UUID || '';
            document.getElementById('protocol').value = currentConfig.ÂçèËÆÆÁ±ªÂûã || 'vless';
            //document.getElementById('transport').value = currentConfig.‰º†ËæìÂçèËÆÆ || 'ws';
            document.getElementById('skipVerify').checked = currentConfig.Ë∑≥ËøáËØÅ‰π¶È™åËØÅ || false;

            // Âèç‰ª£ËêΩÂú∞ËÆæÁΩÆ
            const socksEnabled = currentConfig.Âèç‰ª£?.SOCKS5?.ÂêØÁî®;
            if (!socksEnabled) {
                document.getElementById('proxyMode').value = 'auto';
                document.getElementById('proxyIP').value = currentConfig.Âèç‰ª£?.PROXYIP || '';
                document.getElementById('autoProxy').checked = (currentConfig.Âèç‰ª£?.PROXYIP === 'auto');
                if (currentConfig.Âèç‰ª£?.PROXYIP === 'auto') {
                    document.getElementById('proxyIP').disabled = true;
                }
            } else if (socksEnabled === 'socks5') {
                document.getElementById('proxyMode').value = 'socks5';
                document.getElementById('socks5Addr').value = currentConfig.Âèç‰ª£?.SOCKS5?.Ë¥¶Âè∑ || '';
                document.getElementById('globalSocks5').checked = currentConfig.Âèç‰ª£?.SOCKS5?.ÂÖ®Â±Ä || false;
            } else if (socksEnabled === 'http') {
                document.getElementById('proxyMode').value = 'http';
                document.getElementById('httpAddr').value = currentConfig.Âèç‰ª£?.SOCKS5?.Ë¥¶Âè∑ || '';
                document.getElementById('globalHTTP').checked = currentConfig.Âèç‰ª£?.SOCKS5?.ÂÖ®Â±Ä || false;
            }
            updateProxyMode();

            // ËÆ¢ÈòÖËΩ¨Êç¢ÈÖçÁΩÆ
            document.getElementById('subAPI').value = currentConfig.ËÆ¢ÈòÖËΩ¨Êç¢ÈÖçÁΩÆ?.SUBAPI || '';
            document.getElementById('subConfig').value = currentConfig.ËÆ¢ÈòÖËΩ¨Êç¢ÈÖçÁΩÆ?.SUBCONFIG || '';
            document.getElementById('emoji').checked = currentConfig.ËÆ¢ÈòÖËΩ¨Êç¢ÈÖçÁΩÆ?.SUBEMOJI || false;

            // Ê∂àÊÅØÈÄöÁü•ËÆæÁΩÆ - ÂÖºÂÆπ‰∏§ÁßçconfigÁªìÊûÑ
            // ‰ºòÂÖàËØªÂèñ TG Â≠óÊÆµÔºåÂ¶ÇÊûúÊ≤°ÊúâÂàôËØªÂèñ ÈÄöÁü•.Telegram
            const telegramBotToken = currentConfig.TG?.BotToken || currentConfig.ÈÄöÁü•?.Telegram?.BotToken;
            const telegramChatID = currentConfig.TG?.ChatID || currentConfig.ÈÄöÁü•?.Telegram?.ChatID;
            const telegramCheckbox = document.getElementById('telegramEnabled');

            // Âà§Êñ≠TGÈÖçÁΩÆÊòØÂê¶ÂÆåÊï¥ÔºàBotTokenÂíåChatIDÈÉΩÈùûnull‰∏îÈùûÁ©∫Â≠óÁ¨¶‰∏≤Ôºâ
            if (telegramBotToken && telegramChatID) {
                // ‰∏§‰∏™ÈÉΩÊúâÔºåÂêØÁî®checkboxÔºåÂπ∂Âä†ËΩΩ TG.ÂêØÁî® ÁöÑÁä∂ÊÄÅ
                telegramCheckbox.disabled = false;
                telegramCheckbox.checked = currentConfig.TG?.ÂêØÁî® ?? false;
            } else {
                // ‰ªªÊÑè‰∏Ä‰∏™Áº∫Â∞ëÔºåÁ¶ÅÁî®checkbox
                telegramCheckbox.disabled = true;
                telegramCheckbox.checked = false;
            }

            modifiedSections.clear();
            resetAllButtons();

            // ‰ªé localStorage Âä†ËΩΩÊ®°ÂùóÂ±ïÂºÄ/ÊäòÂè†Áä∂ÊÄÅ
            loadModuleStates();
        }

        // CF ‰ΩøÁî®ÊÉÖÂÜµÊòæÁ§∫ÂáΩÊï∞
        function updateCFUsageDisplay(cfUsage) {
            const workers = cfUsage.workers || 0;
            const pages = cfUsage.pages || 0;
            const total = cfUsage.total || 0;
            const dailyQuota = 100000;

            // Êõ¥Êñ∞ÊòæÁ§∫Êï∞ÂÄº
            document.getElementById('cfWorkerCount').textContent = workers.toLocaleString();
            document.getElementById('cfPagesCount').textContent = pages.toLocaleString();
            document.getElementById('cfTotalDisplay').textContent = total.toLocaleString();

            // ËÆ°ÁÆóÁôæÂàÜÊØî
            const percentage = ((total / dailyQuota) * 100).toFixed(2);

            // ËÆ°ÁÆóÊØî‰æãÂπ∂ËÆæÁΩÆËøõÂ∫¶Êù°ÂÆΩÂ∫¶
            const workersRatio = (workers / dailyQuota) * 100;
            const pagesRatio = (pages / dailyQuota) * 100;

            // Workers ËøõÂ∫¶Êù°Ôºö‰ªéÂ∑¶ËæπÂºÄÂßã
            const workerBarEl = document.getElementById('cfWorkerBar');
            workerBarEl.style.width = Math.min(workersRatio, 100) + '%';
            workerBarEl.textContent = '';

            // Pages ËøõÂ∫¶Êù°ÔºöÁ¥ßË∑üÂú® Workers ËøõÂ∫¶Êù°ÂêéÈù¢
            const pagesBarEl = document.getElementById('cfPagesBar');
            pagesBarEl.style.width = Math.min(pagesRatio, 100 - workersRatio) + '%';
            pagesBarEl.style.left = Math.min(workersRatio, 100) + '%';
            pagesBarEl.textContent = '';

            // ÊÄª‰ΩìÁôæÂàÜÊØîÊñáÂ≠ó (‰∏≠Â§Æ)
            const percentageCenterEl = document.getElementById('cfPercentageCenter');
            percentageCenterEl.textContent = `ËØ∑Ê±Ç‰ΩøÁî®ËøõÂ∫¶: ${total.toLocaleString()} (${percentage}%)`;
        }

        async function loadCustomIPs() {
            const textarea = document.getElementById('customIPs');
            textarea.disabled = true;
            textarea.value = 'Ê≠£Âú®Âä†ËΩΩ...';

            try {
                const response = await fetch('/admin/ADD.txt?t=' + Date.now());
                if (response.ok) {
                    textarea.value = await response.text();
                } else {
                    textarea.value = '';
                }
            } catch (error) {
                showToast('Âä†ËΩΩËá™ÂÆö‰πâIPÂ§±Ë¥•', 'error');
                textarea.value = '';
            } finally {
                textarea.disabled = false;
            }
        }

        function updateIPMode() {
            const mode = document.getElementById('ipMode').value;
            document.getElementById('randomIPSection').style.display = mode === 'random' ? 'grid' : 'none';
            document.getElementById('customIPSection').style.display = mode === 'custom' ? 'block' : 'none';
            document.getElementById('generatorSection').style.display = mode === 'generator' ? 'grid' : 'none';

            // ÂΩìÂàáÊç¢Âà∞Ëá™ÂÆö‰πâ‰ºòÈÄâÊó∂ÔºåËá™Âä®Âä†ËΩΩÁé∞ÊúâÁöÑADD.txtÂÜÖÂÆπ
            if (mode === 'custom') {
                loadCustomIPs();
            }

            markModified('sub');
        }

        // Â§ÑÁêÜ‰ºòÈÄâËÆ¢ÈòÖÁîüÊàêÂô®URL
        function processGeneratorURL() {
            const input = document.getElementById('generatorURL').value.trim();
            let domain = '';

            if (input) {
                // Â¶ÇÊûúËæìÂÖ•‰∏çÊòØÁ©∫ÁöÑÔºåÊèêÂèñÂüüÂêç
                domain = extractDomain(input);
                document.getElementById('generatorURL').value = domain;
            }

            markModified('sub');
        }

        // ÊèêÂèñURL‰∏≠ÁöÑÁ∫ØÂüüÂêç
        function extractDomain(url) {
            try {
                url = url.trim();

                // Â¶ÇÊûú‰∏çÂåÖÂê´ÂçèËÆÆÔºåÂ∞ùËØïËØÜÂà´ÊòØÂê¶‰∏∫ÂÆåÊï¥URLÊàñÁ∫ØÂüüÂêç
                if (!url.includes('://')) {
                    // Ê£ÄÊü•ÊòØÂê¶ÂåÖÂê´Ë∑ØÂæÑ„ÄÅÊü•ËØ¢ÂèÇÊï∞ÊàñÁ´ØÂè£
                    if (url.includes('/') || url.includes('?') || url.includes(':')) {
                        // ËøôÊòØ‰∏Ä‰∏™ÂÆåÊï¥ÁöÑURLÔºåË°•ÂÖÖhttpsÂçèËÆÆ
                        url = 'https://' + url;
                    } else {
                        // ËøôÊòØÁ∫ØÂüüÂêçÔºåÁõ¥Êé•ËøîÂõû
                        return url;
                    }
                }

                // Ëß£ÊûêURL
                const urlObj = new URL(url);

                // Ëé∑ÂèñhostnameÔºà‰∏çÂåÖÂê´Á´ØÂè£Ôºâ
                let domain = urlObj.hostname;

                // ÁßªÈô§wwwÂâçÁºÄÔºàÂ¶ÇÊûúÊúâÔºâ
                if (domain.startsWith('www.')) {
                    domain = domain.substring(4);
                }

                return domain;
            } catch (error) {
                // Â¶ÇÊûúURLËß£ÊûêÂ§±Ë¥•ÔºåËøîÂõûÂéüÂßãËæìÂÖ•ÂéªÊéâÂçèËÆÆÈÉ®ÂàÜÁöÑÁªìÊûú
                let temp = url.trim();
                if (temp.includes('://')) {
                    temp = temp.split('://')[1];
                }
                if (temp.includes('/')) {
                    temp = temp.split('/')[0];
                }
                if (temp.includes('?')) {
                    temp = temp.split('?')[0];
                }
                if (temp.includes(':')) {
                    temp = temp.split(':')[0];
                }
                if (temp.startsWith('www.')) {
                    temp = temp.substring(4);
                }
                return temp;
            }
        }

        function updateProtocol() {
            const protocol = document.getElementById('protocol').value;
            /*
            const transport = document.getElementById('transport');
            if (protocol === 'trojan') {
                transport.value = 'ws';
                transport.disabled = true;
            } else {
                transport.disabled = false;
            }
            */
        }

        // Â§ÑÁêÜPROXYIPÂú∞ÂùÄ
        function processProxyIP() {
            const input = document.getElementById('proxyIP').value.trim();

            if (input && input !== 'auto') {
                const cleanAddress = extractProxyIPAddress(input);
                document.getElementById('proxyIP').value = cleanAddress;
            }

            markModified('proxy');
        }

        // ÊèêÂèñPROXYIPÂú∞ÂùÄ‰∏≠ÁöÑÁ∫ØÊ†ºÂºèÔºà‰øùÁïôÁ´ØÂè£Âè∑Ôºâ
        function extractProxyIPAddress(input) {
            input = input.trim();

            // È¶ñÂÖàÊ£ÄÊü•ÊòØÂê¶ÂåÖÂê´ "ip=" (ÂåÖÊã¨ proxyip= Âíå pyip=)
            const ipPatterns = ['proxyip=', 'pyip=', 'ip='];
            for (const pattern of ipPatterns) {
                const index = input.toLowerCase().indexOf(pattern);
                if (index !== -1) {
                    input = input.substring(index + pattern.length).trim();
                    break;
                }
            }

            // ÁßªÈô§ÂçèËÆÆÂâçÁºÄ (http:// Êàñ https://)
            if (input.toLowerCase().startsWith('http://')) {
                input = input.substring(7).trim();
            } else if (input.toLowerCase().startsWith('https://')) {
                input = input.substring(8).trim();
            }

            // ÁßªÈô§Êú´Â∞æÁöÑÊñúÊù†
            if (input.endsWith('/')) {
                input = input.substring(0, input.length - 1).trim();
            }

            // ÁßªÈô§Êú´Â∞æÁöÑÂ§áÊ≥®Ôºà#Á¨¶Âè∑‰πãÂêéÁöÑÂÜÖÂÆπÔºâ
            if (input.includes('#')) {
                input = input.split('#')[0].trim();
            }

            return input;
        }

        // Â§ÑÁêÜSOCKS5ÂíåHTTP‰ª£ÁêÜÂú∞ÂùÄ
        function processProxyAddress(type) {
            const fieldId = type === 'socks5' ? 'socks5Addr' : 'httpAddr';
            const input = document.getElementById(fieldId).value.trim();
            let cleanAddress = '';

            if (input) {
                cleanAddress = extractProxyAddress(input, type);
                document.getElementById(fieldId).value = cleanAddress;

                // Â¶ÇÊûúËæìÂÖ•ÂÜÖÂÆπÂåÖÂê´ÂçèËÆÆÊ†áËØÜÔºåËá™Âä®ÂàáÊç¢Âèç‰ª£Ê®°ÂºèÂπ∂ËΩ¨ÁßªÂÜÖÂÆπ
                switchProxyModeByProtocol(input, cleanAddress);
            }

            markModified('proxy');
        }

        // ÊèêÂèñ‰ª£ÁêÜÂú∞ÂùÄ‰∏≠ÁöÑÁ∫ØÊ†ºÂºè
        function extractProxyAddress(input, type) {
            input = input.trim();

            // ÁßªÈô§ÂºÄÂ§¥ÁöÑ "/" Êàñ "/"
            if (input.startsWith('/')) {
                input = input.substring(1).trim();
            }

            // Ê£ÄÊµãÂπ∂ÁßªÈô§ÂçèËÆÆÂâçÁºÄ
            const socks5Prefixes = ['socks5://', 'socks5=', 'socks5://'];
            const httpPrefixes = ['http://', 'http=', 'https://'];

            for (const prefix of socks5Prefixes) {
                if (input.toLowerCase().startsWith(prefix)) {
                    input = input.substring(prefix.length).trim();
                    break;
                }
            }

            for (const prefix of httpPrefixes) {
                if (input.toLowerCase().startsWith(prefix)) {
                    input = input.substring(prefix.length).trim();
                    break;
                }
            }

            // ÁßªÈô§Êú´Â∞æÁöÑÂ§áÊ≥®Ôºà#Á¨¶Âè∑‰πãÂêéÁöÑÂÜÖÂÆπÔºâ
            if (input.includes('#')) {
                input = input.split('#')[0].trim();
            }

            return input;
        }

        // Ê†πÊçÆÂçèËÆÆËá™Âä®ÂàáÊç¢Âèç‰ª£Ê®°Âºè
        function switchProxyModeByProtocol(input, cleanAddress) {
            const lowerInput = input.toLowerCase();

            // Ê£ÄÊü•ÊòØÂê¶ÂåÖÂê´socks5ÂçèËÆÆ
            if (lowerInput.includes('socks5://') || lowerInput.includes('socks5=') || lowerInput.startsWith('/socks')) {
                // ÂàáÊç¢Âà∞SOCKS5Ê®°Âºè
                document.getElementById('proxyMode').value = 'socks5';

                // Ê∏ÖÁ©∫ÂÖ∂‰ªñÊ®°ÂºèÁöÑÂÜÖÂÆπÔºåÂ°´ÂÖÖSOCKS5
                document.getElementById('proxyIP').value = '';
                document.getElementById('socks5Addr').value = cleanAddress;
                document.getElementById('httpAddr').value = '';

                updateProxyMode();
                return;
            }

            // Ê£ÄÊü•ÊòØÂê¶ÂåÖÂê´httpÂçèËÆÆ
            if (lowerInput.includes('http://') || lowerInput.includes('http=') || lowerInput.includes('https://') || lowerInput.startsWith('/http')) {
                // ÂàáÊç¢Âà∞HTTPÊ®°Âºè
                document.getElementById('proxyMode').value = 'http';

                // Ê∏ÖÁ©∫ÂÖ∂‰ªñÊ®°ÂºèÁöÑÂÜÖÂÆπÔºåÂ°´ÂÖÖHTTP
                document.getElementById('proxyIP').value = '';
                document.getElementById('socks5Addr').value = '';
                document.getElementById('httpAddr').value = cleanAddress;

                updateProxyMode();
                return;
            }
        }

        function updateProxyMode() {
            const mode = document.getElementById('proxyMode').value;
            document.getElementById('proxyIPSection').style.display = mode === 'auto' ? 'block' : 'none';
            document.getElementById('socks5Section').style.display = mode === 'socks5' ? 'block' : 'none';
            document.getElementById('httpSection').style.display = mode === 'http' ? 'block' : 'none';
            markModified('proxy');
        }

        function toggleAutoProxy() {
            const autoProxy = document.getElementById('autoProxy').checked;
            document.getElementById('proxyIP').disabled = autoProxy;
            markModified('proxy');
        }

        function toggleModule(titleEl) {
            const module = titleEl.parentElement;
            const content = module.querySelector('.module-content');

            // If there's no collapsible content, just toggle the class
            if (!content) {
                module.classList.toggle('collapsed');
                saveModuleStates();
                return;
            }

            // If a transition is currently attached, remove it to avoid duplicate handlers
            if (content._transitionHandler) {
                content.removeEventListener('transitionend', content._transitionHandler);
                content._transitionHandler = null;
            }

            const isCollapsed = module.classList.contains('collapsed');

            if (isCollapsed) {
                // Expand
                content.style.display = 'block';
                // Measure height
                const height = content.scrollHeight;
                // Start from 0
                content.style.maxHeight = '0px';
                content.style.opacity = '0';
                // Force reflow
                content.getBoundingClientRect();
                // Animate to measured height
                content.style.maxHeight = height + 'px';
                content.style.opacity = '1';

                const onEnd = function (e) {
                    if (e.propertyName === 'max-height') {
                        // Clear fixed max-height so content can grow/shrink naturally
                        content.style.maxHeight = '';
                        content.removeEventListener('transitionend', onEnd);
                        content._transitionHandler = null;
                    }
                };
                content._transitionHandler = onEnd;
                content.addEventListener('transitionend', onEnd);

                module.classList.remove('collapsed');
            } else {
                // Collapse
                const height = content.scrollHeight;
                // Ensure starting height is set
                content.style.maxHeight = height + 'px';
                content.style.opacity = '1';
                // Force reflow
                content.getBoundingClientRect();
                // Animate to 0
                content.style.maxHeight = '0px';
                content.style.opacity = '0';

                const onEnd = function (e) {
                    if (e.propertyName === 'max-height') {
                        // Hide after collapsing to remove from tab order
                        content.style.display = 'none';
                        content.removeEventListener('transitionend', onEnd);
                        content._transitionHandler = null;
                    }
                };
                content._transitionHandler = onEnd;
                content.addEventListener('transitionend', onEnd);

                module.classList.add('collapsed');
            }

            // ‰øùÂ≠òÊ®°ÂùóÁä∂ÊÄÅÂà∞ localStorage
            saveModuleStates();
        }

        function markModified(section) {
            modifiedSections.add(section);

            // ÁâπÊÆäÂ§ÑÁêÜ notification ÈÉ®ÂàÜÔºöÊõ¥Êñ∞ TG.ÂêØÁî® Áä∂ÊÄÅ
            if (section === 'notification') {
                const telegramCheckbox = document.getElementById('telegramEnabled');
                if (!currentConfig.TG) currentConfig.TG = {};
                currentConfig.TG.ÂêØÁî® = telegramCheckbox.checked;
            }

            updateButtonStates();
        }

        function updateButtonStates() {
            // ËÆ¢ÈòÖÁîüÊàêÊ®°Âùó
            const subModified = modifiedSections.has('sub');
            document.getElementById('saveSubBtn').disabled = !subModified;
            document.getElementById('cancelSubBtn').disabled = !subModified;

            // ÈÖçÁΩÆ‰ø°ÊÅØÊ®°Âùó
            const configModified = modifiedSections.has('config');
            document.getElementById('saveConfigBtn').disabled = !configModified;
            document.getElementById('cancelConfigBtn').disabled = !configModified;

            // Âèç‰ª£ËÆæÁΩÆÊ®°Âùó
            const proxyModified = modifiedSections.has('proxy');
            document.getElementById('saveProxyBtn').disabled = !proxyModified;
            document.getElementById('cancelProxyBtn').disabled = !proxyModified;

            // ËÆ¢ÈòÖËΩ¨Êç¢Ê®°Âùó
            const convertModified = modifiedSections.has('convert');
            document.getElementById('saveConvertBtn').disabled = !convertModified;
            document.getElementById('cancelConvertBtn').disabled = !convertModified;

            // ÈÄöÁü•ËÆæÁΩÆÊ®°Âùó
            const notificationModified = modifiedSections.has('notification');
            document.getElementById('saveNotificationBtn').disabled = !notificationModified;
            document.getElementById('cancelNotificationBtn').disabled = !notificationModified;
        }

        function resetAllButtons() {
            document.querySelectorAll('[id^="save"]').forEach(btn => btn.disabled = true);
            document.querySelectorAll('[id^="cancel"]').forEach(btn => btn.disabled = true);
        }

        function copySubscription(elementId) {
            const element = document.getElementById(elementId);
            navigator.clipboard.writeText(element.value).then(() => {
                showToast('Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø', 'success');
            }).catch(() => {
                showToast('Â§çÂà∂Â§±Ë¥•', 'error');
            });
        }

        function showQRCode(elementId) {
            const text = document.getElementById(elementId).value;
            const container = document.getElementById('qrcodeContainer');
            container.innerHTML = '';
            new QRCode(container, {
                text: text,
                width: 300,
                height: 300,
                colorDark: '#000',
                colorLight: '#fff',
                correctLevel: QRCode.CorrectLevel.H
            });
            document.getElementById('qrcodeModal').classList.add('show');
        }

        function closeQRCode(event) {
            if (!event || event.target.id === 'qrcodeModal') {
                document.getElementById('qrcodeModal').classList.remove('show');
            }
        }

        async function saveSub() {
            const mode = document.getElementById('ipMode').value;

            // Ê£ÄÊü•ÊñáÊú¨Ê°ÜÂÜÖÂÆπÊòØÂê¶‰∏∫Á©∫
            if (mode === 'random') {
                const randomCount = document.getElementById('randomCount').value.trim();
                if (!randomCount) {
                    showToast('ÈöèÊú∫‰ºòÈÄâÊï∞Èáè‰∏çËÉΩ‰∏∫Á©∫', 'error');
                    return;
                }
            } else if (mode === 'custom') {
                const customIPs = document.getElementById('customIPs').value.trim();
                if (!customIPs) {
                    showToast('Ëá™ÂÆö‰πâ‰ºòÈÄâÂú∞ÂùÄ‰∏çËÉΩ‰∏∫Á©∫', 'error');
                    return;
                }
            } else if (mode === 'generator') {
                const generatorURL = document.getElementById('generatorURL').value.trim();
                if (!generatorURL) {
                    showToast('‰ºòÈÄâËÆ¢ÈòÖÁîüÊàêÂô®Âú∞ÂùÄ‰∏çËÉΩ‰∏∫Á©∫', 'error');
                    return;
                }
            }

            const updates = {
                local: mode !== 'generator',
                Êú¨Âú∞IPÂ∫ì: { ÈöèÊú∫IP: mode === 'random', ÈöèÊú∫Êï∞Èáè: parseInt(document.getElementById('randomCount').value) || 16 },
                SUB: mode === 'generator' ? document.getElementById('generatorURL').value : null,
                SUBNAME: currentConfig.‰ºòÈÄâËÆ¢ÈòÖÁîüÊàê.SUBNAME,
                SUBUpdateTime: currentConfig.‰ºòÈÄâËÆ¢ÈòÖÁîüÊàê.SUBUpdateTime,
                TOKEN: currentConfig.‰ºòÈÄâËÆ¢ÈòÖÁîüÊàê.TOKEN
            };

            currentConfig.‰ºòÈÄâËÆ¢ÈòÖÁîüÊàê = { ...currentConfig.‰ºòÈÄâËÆ¢ÈòÖÁîüÊàê, ...updates };

            if (mode === 'custom') {
                const customIPs = document.getElementById('customIPs').value;
                try {
                    await fetch('/admin/ADD.txt', { method: 'POST', body: customIPs });
                } catch (error) {
                    showToast('‰øùÂ≠òËá™ÂÆö‰πâIPÂ§±Ë¥•', 'error');
                    return;
                }
            }

            await saveConfigToServer('sub');
        }

        async function saveConfig() {
            currentConfig.‰ºòÈÄâËÆ¢ÈòÖÁîüÊàê.SUBNAME = document.getElementById('subName').value;
            currentConfig.ÂçèËÆÆÁ±ªÂûã = document.getElementById('protocol').value;
            //currentConfig.‰º†ËæìÂçèËÆÆ = currentConfig.ÂçèËÆÆÁ±ªÂûã === 'trojan' ? 'ws' : document.getElementById('transport').value;
            currentConfig.Ë∑≥ËøáËØÅ‰π¶È™åËØÅ = document.getElementById('skipVerify').checked;

            await saveConfigToServer('config');
            // Êõ¥Êñ∞ÁΩëÈ°µÊ†áÈ¢ò
            document.title = `${currentConfig.‰ºòÈÄâËÆ¢ÈòÖÁîüÊàê?.SUBNAME || 'edgetunnel'}ËÆæÁΩÆÈ°µÈù¢ - ÁÆ°ÁêÜÂêéÂè∞`;
        }

        async function saveProxy() {
            const mode = document.getElementById('proxyMode').value;
            let socksEnabled = null;
            let socksAccount = '';
            let globalProxy = false;
            let proxyIP = currentConfig.Âèç‰ª£.PROXYIP;

            // Ê£ÄÊü•ÊñáÊú¨Ê°ÜÂÜÖÂÆπÊòØÂê¶‰∏∫Á©∫
            if (mode === 'auto') {
                socksEnabled = null;
                const autoProxy = document.getElementById('autoProxy').checked;
                proxyIP = autoProxy ? 'auto' : document.getElementById('proxyIP').value.trim();

                if (!autoProxy && !proxyIP) {
                    showToast('PROXYIPÂú∞ÂùÄ‰∏çËÉΩ‰∏∫Á©∫', 'error');
                    return;
                }
            } else if (mode === 'socks5') {
                socksEnabled = 'socks5';
                socksAccount = document.getElementById('socks5Addr').value.trim();
                globalProxy = document.getElementById('globalSocks5').checked;

                if (!socksAccount) {
                    showToast('SOCKS5Âú∞ÂùÄ‰∏çËÉΩ‰∏∫Á©∫', 'error');
                    return;
                }
            } else if (mode === 'http') {
                socksEnabled = 'http';
                socksAccount = document.getElementById('httpAddr').value.trim();
                globalProxy = document.getElementById('globalHTTP').checked;

                if (!socksAccount) {
                    showToast('HTTPÂú∞ÂùÄ‰∏çËÉΩ‰∏∫Á©∫', 'error');
                    return;
                }
            }

            currentConfig.Âèç‰ª£ = {
                PROXYIP: proxyIP,
                SOCKS5: {
                    ÂêØÁî®: socksEnabled,
                    ÂÖ®Â±Ä: globalProxy,
                    Ë¥¶Âè∑: socksAccount,
                    ÁôΩÂêçÂçï: currentConfig.Âèç‰ª£.SOCKS5.ÁôΩÂêçÂçï
                }
            };

            await saveConfigToServer('proxy');
        }

        async function saveConvert() {
            currentConfig.ËÆ¢ÈòÖËΩ¨Êç¢ÈÖçÁΩÆ = {
                SUBAPI: document.getElementById('subAPI').value,
                SUBCONFIG: document.getElementById('subConfig').value,
                SUBEMOJI: document.getElementById('emoji').checked
            };

            await saveConfigToServer('convert');
        }

        async function saveConfigToServer(section) {
            try {
                const response = await fetch('/admin/config.json', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(currentConfig)
                });

                if (!response.ok) throw new Error('‰øùÂ≠òÂ§±Ë¥•');
                showToast('ÈÖçÁΩÆÂ∑≤‰øùÂ≠ò', 'success');
                modifiedSections.delete(section);
                updateButtonStates();
            } catch (error) {
                showToast('‰øùÂ≠òÂ§±Ë¥•: ' + error.message, 'error');
            }
        }

        function cancelEdit(section) {
            currentConfig = JSON.parse(JSON.stringify(originalConfig));

            // Âè™ÈáçÁΩÆËØ•Ê®°ÂùóÁöÑÂÄºÔºå‰∏çË∞ÉÁî® renderUI ‰ª•‰øùÊåÅÂ±ïÂºÄÁä∂ÊÄÅ
            if (section === 'sub') {
                const local = currentConfig.‰ºòÈÄâËÆ¢ÈòÖÁîüÊàê?.local ?? true;
                const randomIP = currentConfig.‰ºòÈÄâËÆ¢ÈòÖÁîüÊàê?.Êú¨Âú∞IPÂ∫ì?.ÈöèÊú∫IP ?? true;

                if (!local) {
                    document.getElementById('ipMode').value = 'generator';
                    document.getElementById('generatorURL').value = currentConfig.‰ºòÈÄâËÆ¢ÈòÖÁîüÊàê?.SUB || '';
                } else if (randomIP) {
                    document.getElementById('ipMode').value = 'random';
                    document.getElementById('randomCount').value = currentConfig.‰ºòÈÄâËÆ¢ÈòÖÁîüÊàê?.Êú¨Âú∞IPÂ∫ì?.ÈöèÊú∫Êï∞Èáè || 16;
                } else {
                    document.getElementById('ipMode').value = 'custom';
                    loadCustomIPs();
                }
                updateIPMode();
            } else if (section === 'config') {
                document.getElementById('subName').value = currentConfig.‰ºòÈÄâËÆ¢ÈòÖÁîüÊàê?.SUBNAME || '';
                document.getElementById('nodeHost').value = currentConfig.HOST || '';
                document.getElementById('nodeUUID').value = currentConfig.UUID || '';
                document.getElementById('protocol').value = currentConfig.ÂçèËÆÆÁ±ªÂûã || 'vless';
                document.getElementById('skipVerify').checked = currentConfig.Ë∑≥ËøáËØÅ‰π¶È™åËØÅ || false;
                updateProtocol();
            } else if (section === 'proxy') {
                const socksEnabled = currentConfig.Âèç‰ª£?.SOCKS5?.ÂêØÁî®;
                if (!socksEnabled) {
                    document.getElementById('proxyMode').value = 'auto';
                    document.getElementById('proxyIP').value = currentConfig.Âèç‰ª£?.PROXYIP || '';
                    document.getElementById('autoProxy').checked = (currentConfig.Âèç‰ª£?.PROXYIP === 'auto');
                    if (currentConfig.Âèç‰ª£?.PROXYIP === 'auto') {
                        document.getElementById('proxyIP').disabled = true;
                    }
                } else if (socksEnabled === 'socks5') {
                    document.getElementById('proxyMode').value = 'socks5';
                    document.getElementById('socks5Addr').value = currentConfig.Âèç‰ª£?.SOCKS5?.Ë¥¶Âè∑ || '';
                    document.getElementById('globalSocks5').checked = currentConfig.Âèç‰ª£?.SOCKS5?.ÂÖ®Â±Ä || false;
                } else if (socksEnabled === 'http') {
                    document.getElementById('proxyMode').value = 'http';
                    document.getElementById('httpAddr').value = currentConfig.Âèç‰ª£?.SOCKS5?.Ë¥¶Âè∑ || '';
                    document.getElementById('globalHTTP').checked = currentConfig.Âèç‰ª£?.SOCKS5?.ÂÖ®Â±Ä || false;
                }
                updateProxyMode();
            } else if (section === 'convert') {
                document.getElementById('subAPI').value = currentConfig.ËÆ¢ÈòÖËΩ¨Êç¢ÈÖçÁΩÆ?.SUBAPI || '';
                document.getElementById('subConfig').value = currentConfig.ËÆ¢ÈòÖËΩ¨Êç¢ÈÖçÁΩÆ?.SUBCONFIG || '';
                document.getElementById('emoji').checked = currentConfig.ËÆ¢ÈòÖËΩ¨Êç¢ÈÖçÁΩÆ?.SUBEMOJI || false;
            }

            modifiedSections.delete(section);
            updateButtonStates();
        }

        // ‰øùÂ≠òÊ®°ÂùóÂ±ïÂºÄ/ÊäòÂè†Áä∂ÊÄÅÂà∞ localStorage
        function saveModuleStates() {
            const states = {};
            document.querySelectorAll('.module').forEach((module, index) => {
                const title = module.querySelector('.module-title')?.textContent?.trim() || ('module-' + index);
                // ‰∏ç‰øùÂ≠ò"Êü•ÁúãÊìç‰ΩúÊó•Âøó"Ê®°ÂùóÁöÑÁä∂ÊÄÅ
                if (title !== 'üìã Êü•ÁúãÊìç‰ΩúÊó•Âøó') {
                    states[title] = !module.classList.contains('collapsed');
                }
            });
            localStorage.setItem('adminModuleStates', JSON.stringify(states));
        }

        // ‰ªé localStorage Âä†ËΩΩÊ®°ÂùóÂ±ïÂºÄ/ÊäòÂè†Áä∂ÊÄÅ
        function loadModuleStates() {
            const savedStates = localStorage.getItem('adminModuleStates');
            const states = savedStates ? JSON.parse(savedStates) : {};

            // Â¶ÇÊûúÊòØÁ¨¨‰∏ÄÊ¨°ËÆøÈóÆÔºàlocalStorage‰∏≠Ê≤°Êúâ‰øùÂ≠òÁä∂ÊÄÅÔºâÔºåÊâÄÊúâÊ®°ÂùóÈªòËÆ§ÊäòÂè†
            const isFirstVisit = !savedStates;

            document.querySelectorAll('.module').forEach((module, index) => {
                const title = module.querySelector('.module-title')?.textContent?.trim() || ('module-' + index);
                let shouldBeExpanded;

                // "Êü•ÁúãÊìç‰ΩúÊó•Âøó"Ê®°ÂùóÂßãÁªà‰øùÊåÅÊäòÂè†Áä∂ÊÄÅ
                if (title === 'üìã Êü•ÁúãÊìç‰ΩúÊó•Âøó') {
                    shouldBeExpanded = false;
                } else {
                    shouldBeExpanded = isFirstVisit ? false : (states[title] !== false); // Á¨¨‰∏ÄÊ¨°ÈªòËÆ§ÊäòÂè†Ôºå‰πãÂêéÊåâ‰øùÂ≠òÁöÑÁä∂ÊÄÅ
                }

                const isCurrentlyCollapsed = module.classList.contains('collapsed');
                const content = module.querySelector('.module-content');

                if (shouldBeExpanded && isCurrentlyCollapsed) {
                    // ÈúÄË¶ÅÂ±ïÂºÄ
                    module.classList.remove('collapsed');
                    if (content) {
                        content.style.display = 'block';
                        content.style.maxHeight = '';
                        content.style.opacity = '1';
                    }
                } else if (!shouldBeExpanded && !isCurrentlyCollapsed) {
                    // ÈúÄË¶ÅÊäòÂè†
                    module.classList.add('collapsed');
                    if (content) {
                        content.style.display = 'none';
                        content.style.maxHeight = '0px';
                        content.style.opacity = '0';
                    }
                }
            });
        }

        async function refreshConfig() {
            await loadConfig();
            const loadTime = currentConfig.Âä†ËΩΩÊó∂Èó¥ || 'Êú™Áü•';
            showToast(`ÈÖçÁΩÆÂ∑≤Âà∑Êñ∞ (Âä†ËΩΩÊó∂Èó¥: ${loadTime})`, 'success');
        }

        function resetConfigWithConfirm() {
            document.getElementById('resetModal').classList.add('show');
        }

        function closeResetModal(event) {
            if (event && event.target.id !== 'resetModal') return;
            document.getElementById('resetModal').classList.remove('show');
        }

        async function confirmReset() {
            try {
                const response = await fetch('/admin/init');
                if (!response.ok) throw new Error('ÈáçÁΩÆÂ§±Ë¥•');

                closeResetModal();
                showToast('ÈÖçÁΩÆÂ∑≤ÈáçÁΩÆ‰∏∫ÈªòËÆ§ÂÄº', 'success');

                // Âª∂Ëøü1ÁßíÂêéÂà∑Êñ∞È°µÈù¢ÔºåËÆ©Áî®Êà∑ÁúãÂà∞ÊàêÂäüÊèêÁ§∫
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            } catch (error) {
                showToast('ÈáçÁΩÆÂ§±Ë¥•: ' + error.message, 'error');
            }
        }

        function logout() {
            window.location.href = '/logout';
        }

        function showToast(message, type = 'info') {
            // ÁßªÈô§Áé∞ÊúâÁöÑtoast
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }

            // ÂàõÂª∫Êñ∞ÁöÑtoast
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);

            // ÊòæÁ§∫Âä®Áîª
            setTimeout(() => toast.classList.add('show'), 10);

            // Ëá™Âä®ÈöêËóè
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Êó•ÂøóÁ±ªÂûãÁøªËØë
        function translateLogType(type, ua = '') {
            // Â¶ÇÊûúÊòØ Get_SUB Á±ªÂûãÔºåÊ£ÄÊü• UA ÊòØÂê¶ÂåÖÂê´ subconverter
            if (type === 'Get_SUB') {
                const uaLowercase = (ua || '').toLowerCase();
                if (uaLowercase.includes('subconverter')) {
                    return { text: 'ËÆ¢ÈòÖËΩ¨Êç¢', color: '#3b82f6' };
                }
                return { text: 'Ëé∑ÂèñËÆ¢ÈòÖ', color: '#10b981' };
            }

            const typeMap = {
                'Admin_Login': { text: 'ÁôªÂΩïÂêéÂè∞', color: '#f59e0b' },
                'Save_Config': { text: '‰øùÂ≠òÈÖçÁΩÆ', color: '#8b5cf6' },
                'Init_Config': { text: 'ÈáçÁΩÆÈÖçÁΩÆ', color: '#ef4444' },
                'Save_Custom_IPs': { text: 'Ëá™ÂÆö‰πâ‰ºòÈÄâ', color: '#06b6d4' }
            };
            return typeMap[type] || { text: type, color: '#6b7280' };
        }

        // Ê†ºÂºèÂåñÊó∂Èó¥Êà≥‰∏∫ UTC+8
        function formatTime(timestamp) {
            const date = new Date(timestamp + 8 * 3600 * 1000);
            const year = date.getUTCFullYear();
            const month = String(date.getUTCMonth() + 1).padStart(2, '0');
            const day = String(date.getUTCDate()).padStart(2, '0');
            const hours = String(date.getUTCHours()).padStart(2, '0');
            const minutes = String(date.getUTCMinutes()).padStart(2, '0');
            const seconds = String(date.getUTCSeconds()).padStart(2, '0');
            return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        }

        // Âú®Â±ïÂºÄÊó•ÂøóÊ®°ÂùóÊó∂Âä†ËΩΩÊó•Âøó
        let logsLoaded = false;
        function loadLogsOnExpand(titleEl) {
            const module = titleEl.parentElement;
            const isCollapsed = module.classList.contains('collapsed');

            // Â¶ÇÊûúÊòØÂ±ïÂºÄÁä∂ÊÄÅ‰∏îËøòÊú™Âä†ËΩΩËøáÊó•ÂøóÔºåÂàôÂä†ËΩΩ
            if (!isCollapsed && !logsLoaded) {
                loadLogs();
            }
        }

        // Âä†ËΩΩÊúÄËøë8Êù°Êó•Âøó
        async function loadLogs() {
            try {
                const response = await fetch('/admin/log.json?t=' + Date.now());
                if (!response.ok) throw new Error('Âä†ËΩΩÊó•ÂøóÂ§±Ë¥•');
                const logs = await response.json();
                logsLoaded = true;

                // ÊåâÊó∂Èó¥‰ªéÊñ∞Âà∞ÊóßÊéíÂ∫èÔºåÂèñÂâç6Êù°
                const recentLogs = logs.sort((a, b) => b.TIME - a.TIME).slice(0, 6);

                const container = document.getElementById('logsContainer');
                if (recentLogs.length === 0) {
                    container.innerHTML = '<div style="text-align: center; padding: 20px; color: #6b7280;">ÊöÇÊó†Êó•ÂøóËÆ∞ÂΩï</div>';
                    return;
                }

                // Ê£ÄÊü•ÊòØÂê¶‰∏∫ÁßªÂä®ËÆæÂ§á
                const isMobile = window.innerWidth <= 768;

                let html = '<table style="width: 100%; border-collapse: collapse;">';
                if (isMobile) {
                    // ÁßªÂä®ËÆæÂ§áÔºöÊòæÁ§∫Êó∂Èó¥„ÄÅIP„ÄÅÊìç‰Ωú
                    html += '<thead><tr style="border-bottom: 2px solid #e5e7eb;"><th style="text-align: left; padding: 10px; font-weight: 600;">Êó∂Èó¥ (UTC+8)</th><th style="text-align: left; padding: 10px; font-weight: 600;">IP</th><th style="text-align: left; padding: 10px; font-weight: 600;">Êìç‰Ωú</th></tr></thead>';
                } else {
                    // Ê°åÈù¢ËÆæÂ§áÔºöÊòæÁ§∫Êó∂Èó¥„ÄÅIP„ÄÅÂú∞Âå∫„ÄÅÊìç‰Ωú
                    html += '<thead><tr style="border-bottom: 2px solid #e5e7eb;"><th style="text-align: left; padding: 10px; font-weight: 600;">Êó∂Èó¥ (UTC+8)</th><th style="text-align: left; padding: 10px; font-weight: 600;">IP</th><th style="text-align: left; padding: 10px; font-weight: 600;">Âú∞Âå∫</th><th style="text-align: left; padding: 10px; font-weight: 600;">Êìç‰Ωú</th></tr></thead>';
                }
                html += '<tbody>';

                recentLogs.forEach(log => {
                    const logType = translateLogType(log.TYPE, log.UA);
                    const cc = log.CC || 'Êú™Áü•';
                    const timeStr = formatTime(log.TIME);
                    const ip = log.IP || 'Êú™Áü•';

                    if (isMobile) {
                        // ÁßªÂä®ËÆæÂ§áÔºö‰∏çÊòæÁ§∫Âú∞Âå∫
                        html += `<tr style="border-bottom: 1px solid #f3f4f6;"><td style="padding: 10px; font-size: 12px;">${timeStr}</td><td style="padding: 10px; font-family: monospace; font-size: 12px;">${ip}</td><td style="padding: 10px;"><span style="display: inline-block; padding: 4px 12px; border-radius: 4px; font-size: 12px; color: #fff; background-color: ${logType.color};">${logType.text}</span></td></tr>`;
                    } else {
                        // Ê°åÈù¢ËÆæÂ§áÔºöÊòæÁ§∫Âú∞Âå∫
                        html += `<tr style="border-bottom: 1px solid #f3f4f6;"><td style="padding: 10px;">${timeStr}</td><td style="padding: 10px; font-family: monospace; font-size: 12px;">${ip}</td><td style="padding: 10px;">${cc}</td><td style="padding: 10px;"><span style="display: inline-block; padding: 4px 12px; border-radius: 4px; font-size: 12px; color: #fff; background-color: ${logType.color};">${logType.text}</span></td></tr>`;
                    }
                });

                html += '</tbody></table>';
                container.innerHTML = html;
            } catch (error) {
                const container = document.getElementById('logsContainer');
                container.innerHTML = `<div style="text-align: center; padding: 20px; color: #ef4444;">Âä†ËΩΩÊó•ÂøóÂ§±Ë¥•: ${error.message}</div>`;
            }
        }

        // ÊòæÁ§∫ÂÖ®ÈÉ®Êó•Âøó
        async function showAllLogs() {
            try {
                const response = await fetch('/admin/log.json?t=' + Date.now());
                if (!response.ok) throw new Error('Âä†ËΩΩÊó•ÂøóÂ§±Ë¥•');
                const logs = await response.json();

                // ÊåâÊó∂Èó¥‰ªéÊñ∞Âà∞ÊóßÊéíÂ∫è
                const sortedLogs = logs.sort((a, b) => b.TIME - a.TIME);

                const container = document.getElementById('allLogsContainer');
                let html = '<table style="width: 100%; border-collapse: collapse; font-size: 12px; table-layout: auto;">';
                html += '<thead><tr style="border-bottom: 2px solid #e5e7eb; background: #f9fafb; white-space: nowrap;"><th style="text-align: left; padding: 10px; font-weight: 600; width: 160px;">Êó∂Èó¥ (UTC+8)</th><th style="text-align: left; padding: 10px; font-weight: 600; width: 120px;">IP</th><th style="text-align: left; padding: 10px; font-weight: 600; width: 80px;">Âú∞Âå∫</th><th style="text-align: left; padding: 10px; font-weight: 600; width: 80px;">ASN</th><th style="text-align: left; padding: 10px; font-weight: 600; width: 150px;">Êìç‰Ωú</th><th style="text-align: left; padding: 10px; font-weight: 600; flex: 1; min-width: 300px;">URL</th><th style="text-align: left; padding: 10px; font-weight: 600; flex: 1; min-width: 200px;">UA</th></tr></thead>';
                html += '<tbody>';

                sortedLogs.forEach(log => {
                    const logType = translateLogType(log.TYPE, log.UA);
                    const cc = log.CC || 'Êú™Áü•';
                    const asn = log.ASN || 'Êú™Áü•';
                    const timeStr = formatTime(log.TIME);
                    const ip = log.IP || 'Êú™Áü•';
                    const url = log.URL || 'Êó†';
                    const ua = log.UA ? log.UA.substring(0, 60) : 'Êó†';

                    html += `<tr style="border-bottom: 1px solid #f3f4f6;"><td style="text-align: left; padding: 8px; white-space: nowrap; width: 160px; font-size: 11px;">${timeStr}</td><td style="text-align: left; padding: 8px; font-family: monospace; font-size: 10px; white-space: nowrap; width: 120px; word-break: break-word;">${ip}</td><td style="text-align: left; padding: 8px; white-space: nowrap; width: 80px; font-size: 11px;">${cc}</td><td style="text-align: left; padding: 8px; white-space: nowrap; width: 80px; font-size: 11px; font-family: monospace;">${asn}</td><td style="text-align: left; padding: 8px; width: 150px;"><span style="display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 11px; color: #fff; background-color: ${logType.color}; white-space: nowrap;">${logType.text}</span></td><td style="text-align: left; padding: 8px; font-size: 11px; word-break: break-word; min-width: 300px;">${url}</td><td style="text-align: left; padding: 8px; font-size: 10px; color: #6b7280; min-width: 200px; word-break: break-word;">${ua}</td></tr>`;
                });

                html += '</tbody></table>';
                container.innerHTML = html;
                document.getElementById('logsModal').classList.add('show');
            } catch (error) {
                showToast('Âä†ËΩΩÊó•ÂøóÂ§±Ë¥•: ' + error.message, 'error');
            }
        }

        // ÂÖ≥Èó≠Êó•ÂøóÊ®°ÊÄÅÊ°Ü
        function closeLogsModal(event) {
            if (event && event.target.id !== 'logsModal') return;
            document.getElementById('logsModal').classList.remove('show');
        }

        function openSubAPIModal() {
            const currentValue = document.getElementById('subAPI').value;
            document.getElementById('testSubAPIInput').value = currentValue;
            document.getElementById('subAPIStatus').style.display = 'none';
            document.getElementById('subAPIStatus').textContent = '';
            document.getElementById('subAPIConfirmBtn').disabled = true;
            document.getElementById('subAPIConfirmBtn').style.opacity = '0.5';
            document.getElementById('subAPIModal').classList.add('show');
        }

        function closeSubAPIModal(event) {
            if (event && event.target.id !== 'subAPIModal') return;
            document.getElementById('subAPIModal').classList.remove('show');
            document.getElementById('testSubAPIInput').value = '';
            document.getElementById('subAPIStatus').style.display = 'none';
        }

        function normalizeSubAPIURL(url) {
            url = url.trim();
            if (!url) return null;

            let parsedURL;

            if (!url.includes('://')) {
                url = 'https://' + url;
            }

            try {
                parsedURL = new URL(url);
            } catch (e) {
                return null;
            }

            const baseURL = parsedURL.origin;
            return baseURL;
        }

        async function testSubAPI() {
            const input = document.getElementById('testSubAPIInput').value.trim();
            if (!input) {
                showStatus('ËØ∑ËæìÂÖ•Âú∞ÂùÄ', 'error');
                return;
            }

            const baseURL = normalizeSubAPIURL(input);
            if (!baseURL) {
                showStatus('Âú∞ÂùÄÊ†ºÂºèÊó†Êïà', 'error');
                return;
            }

            const testURL = baseURL + '/version';
            const statusEl = document.getElementById('subAPIStatus');
            const buttons = document.querySelectorAll('#subAPIModal button.btn');
            const testBtn = buttons[0];

            try {
                testBtn.disabled = true;
                statusEl.textContent = '‚è≥ Ê£ÄÊµã‰∏≠...';
                statusEl.style.display = 'block';
                statusEl.style.background = 'linear-gradient(135deg, #3b82f6 0, #1d4ed8 100%)';
                statusEl.style.color = '#fff';

                const response = await fetch(testURL, {
                    method: 'GET'
                });

                if (response.status === 200) {
                    const content = await response.text();
                    const lowerContent = content.toLowerCase();

                    if (lowerContent.includes('subconverter')) {
                        statusEl.style.background = 'linear-gradient(135deg, #10b981 0, #059669 100%)';
                        statusEl.textContent = '‚úÖ ' + content;
                        document.getElementById('subAPIConfirmBtn').disabled = false;
                        document.getElementById('subAPIConfirmBtn').style.opacity = '1';
                        document.getElementById('subAPIConfirmBtn').dataset.validURL = baseURL;
                    } else {
                        statusEl.style.background = 'linear-gradient(135deg, #ef4444 0, #dc2626 100%)';
                        statusEl.textContent = '‚ùå ÂìçÂ∫îÂÜÖÂÆπÊó†Êïà';
                        document.getElementById('subAPIConfirmBtn').disabled = true;
                        document.getElementById('subAPIConfirmBtn').style.opacity = '0.5';
                    }
                } else {
                    statusEl.style.background = 'linear-gradient(135deg, #ef4444 0, #dc2626 100%)';
                    statusEl.textContent = '‚ùå ËØ∑Ê±ÇÂ§±Ë¥• (HTTP ' + response.status + ')';
                    document.getElementById('subAPIConfirmBtn').disabled = true;
                    document.getElementById('subAPIConfirmBtn').style.opacity = '0.5';
                }
            } catch (error) {
                statusEl.style.background = 'linear-gradient(135deg, #ef4444 0, #dc2626 100%)';
                statusEl.textContent = '‚ùå Ê£ÄÊµãÂ§±Ë¥•: ' + error.message;
                document.getElementById('subAPIConfirmBtn').disabled = true;
                document.getElementById('subAPIConfirmBtn').style.opacity = '0.5';
            } finally {
                testBtn.disabled = false;
            }
        }

        function showStatus(message, type) {
            const statusEl = document.getElementById('subAPIStatus');
            const prefix = type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';
            statusEl.textContent = prefix + ' ' + message;
            statusEl.style.display = 'block';
            if (type === 'error') {
                statusEl.style.background = 'linear-gradient(135deg, #ef4444 0, #dc2626 100%)';
            } else {
                statusEl.style.background = 'linear-gradient(135deg, #3b82f6 0, #1d4ed8 100%)';
            }
            statusEl.style.color = '#fff';
        }

        function confirmSubAPI() {
            const validURL = document.getElementById('subAPIConfirmBtn').dataset.validURL;
            if (!validURL) return;

            document.getElementById('subAPI').value = validURL;
            markModified('convert');
            closeSubAPIModal();
        }

        // ==================== Ê∂àÊÅØÈÄöÁü•ËÆæÁΩÆÁõ∏ÂÖ≥ÂáΩÊï∞ ====================

        // ÊâìÂºÄ TelegramBot ÈÖçÁΩÆÊ®°ÊÄÅÊ°Ü
        function openTelegramConfigModal() {
            document.getElementById('telegramConfigModal').classList.add('show');
            // Âè™Âä†ËΩΩChat IDÔºå‰∏çÂä†ËΩΩBot TokenÔºàÂõ†‰∏∫Bot TokenÊòØÊïèÊÑü‰ø°ÊÅØÔºâ
            const chatID = currentConfig.TG?.ChatID || currentConfig.ÈÄöÁü•?.Telegram?.ChatID || '';
            document.getElementById('telegramBotToken').value = '';
            document.getElementById('telegramChatID').value = chatID;

            // ÈáçÁΩÆÁä∂ÊÄÅÂíå‰øùÂ≠òÊåâÈíÆ
            document.getElementById('telegramStatus').style.display = 'none';
            document.getElementById('telegramStatus').textContent = '';
            document.getElementById('telegramConfirmBtn').disabled = true;
            document.getElementById('telegramConfirmBtn').style.opacity = '0.5';
        }

        // ÂÖ≥Èó≠ TelegramBot ÈÖçÁΩÆÊ®°ÊÄÅÊ°Ü
        function closeTelegramConfigModal(event) {
            if (event && event.target.id !== 'telegramConfigModal') return;
            document.getElementById('telegramConfigModal').classList.remove('show');
        }

        // ÊµãËØï TelegramBot ËøûÊé•
        async function testTelegramConfig() {
            const token = document.getElementById('telegramBotToken').value.trim();
            const chatID = document.getElementById('telegramChatID').value.trim();
            const statusEl = document.getElementById('telegramStatus');
            const confirmBtn = document.getElementById('telegramConfirmBtn');
            const testBtn = event.target;

            if (!token || !chatID) {
                statusEl.textContent = '‚ùå ËØ∑Â°´ÂÜôBot TokenÂíåChat ID';
                statusEl.style.display = 'block';
                statusEl.style.background = 'linear-gradient(135deg, #ef4444 0, #dc2626 100%)';
                statusEl.style.color = '#fff';
                confirmBtn.disabled = true;
                confirmBtn.style.opacity = '0.5';
                return;
            }

            try {
                testBtn.disabled = true;
                statusEl.textContent = '‚è≥ È™åËØÅ‰∏≠...';
                statusEl.style.display = 'block';
                statusEl.style.background = 'linear-gradient(135deg, #3b82f6 0, #1d4ed8 100%)';
                statusEl.style.color = '#fff';

                // Á¨¨‰∏ÄÊ≠•ÔºöÈ™åËØÅ Bot Token ÁöÑÊúâÊïàÊÄß
                const getUrlParams = new URLSearchParams({
                    access_token: token
                });
                const getMeUrl = `https://api.telegram.org/bot${token}/getMe`;

                const getMeResponse = await fetch(getMeUrl);
                if (!getMeResponse.ok) {
                    throw new Error('Bot Token Êó†ÊïàÔºåÊó†Ê≥ïËé∑ÂèñÊú∫Âô®‰∫∫‰ø°ÊÅØ');
                }

                const getMeData = await getMeResponse.json();
                if (!getMeData.ok) {
                    throw new Error('Bot Token Êó†Êïà: ' + (getMeData.description || 'Êú™Áü•ÈîôËØØ'));
                }

                // Á¨¨‰∫åÊ≠•ÔºöÈÄöËøáBot TokenÂêëChat IDÊé®ÈÄÅÊµãËØïÊ∂àÊÅØ
                const sendUrlParams = new URLSearchParams({
                    chat_id: chatID,
                    text: '‚úÖ Telegram ÈÄöÁü•ÈÖçÁΩÆÂ∑≤È™åËØÅÊàêÂäüÔºÅ'
                });
                const sendUrl = `https://api.telegram.org/bot${token}/sendMessage?${sendUrlParams}`;

                const sendResponse = await fetch(sendUrl);
                if (!sendResponse.ok) {
                    throw new Error('ÂèëÈÄÅÊ∂àÊÅØÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•Chat IDÊòØÂê¶Ê≠£Á°Æ');
                }

                const sendData = await sendResponse.json();
                if (!sendData.ok) {
                    throw new Error('Chat ID Êó†Êïà: ' + (sendData.description || 'Êú™Áü•ÈîôËØØ'));
                }

                // È™åËØÅÊàêÂäü
                statusEl.style.background = 'linear-gradient(135deg, #10b981 0, #059669 100%)';
                statusEl.textContent = '‚úÖ Bot Token Âíå Chat ID ÂùáÊúâÊïà';
                confirmBtn.disabled = false;
                confirmBtn.style.opacity = '1';

            } catch (error) {
                statusEl.style.background = 'linear-gradient(135deg, #ef4444 0, #dc2626 100%)';
                statusEl.textContent = '‚ùå È™åËØÅÂ§±Ë¥•: ' + error.message;
                confirmBtn.disabled = true;
                confirmBtn.style.opacity = '0.5';
            } finally {
                testBtn.disabled = false;
            }
        }

        // ‰øùÂ≠ò TelegramBot ÈÖçÁΩÆ
        async function confirmTelegramConfig() {
            const token = document.getElementById('telegramBotToken').value.trim();
            const chatID = document.getElementById('telegramChatID').value.trim();
            const confirmBtn = document.getElementById('telegramConfirmBtn');

            // Ê£ÄÊü•ÊåâÈíÆÊòØÂê¶Á¶ÅÁî®ÔºàÂøÖÈ°ªÂÖàÈÄöËøáÈ™åËØÅÔºâ
            if (confirmBtn.disabled) {
                showToast('ËØ∑ÂÖàÁÇπÂáª"ÂèØÁî®ÊÄßÈ™åËØÅ"ÊåâÈíÆÈ™åËØÅÈÖçÁΩÆ', 'error');
                return;
            }

            if (!token || !chatID) {
                showToast('ËØ∑Â°´ÂÜôÂÆåÊï¥ÁöÑBot TokenÂíåChat ID', 'error');
                return;
            }

            try {
                confirmBtn.disabled = true;
                confirmBtn.textContent = '‰øùÂ≠ò‰∏≠...';

                // Êèê‰∫§Âà∞ÂêéÁ´Ø
                const response = await fetch('/admin/tg.json', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        BotToken: token,
                        ChatID: chatID
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    showToast('‚úÖ TelegramBot ÈÖçÁΩÆÂ∑≤‰øùÂ≠ò', 'success');
                    closeTelegramConfigModal();

                    // 1ÁßíÂêéÂà∑Êñ∞È°µÈù¢
                    setTimeout(() => {
                        location.reload();
                    }, 1000);
                } else {
                    const errorData = await response.json();
                    showToast('‚ùå ‰øùÂ≠òÂ§±Ë¥•: ' + (errorData.error || 'Êú™Áü•ÈîôËØØ'), 'error');
                    confirmBtn.disabled = false;
                    confirmBtn.textContent = '‰øùÂ≠ò';
                }
            } catch (error) {
                showToast('‚ùå ‰øùÂ≠òÂ§±Ë¥•: ' + error.message, 'error');
                confirmBtn.disabled = false;
                confirmBtn.textContent = '‰øùÂ≠ò';
            }
        }

        // ÊâìÂºÄ Cloudflare ÈÖçÁΩÆÊ®°ÊÄÅÊ°Ü
        function openCloudflareConfigModal() {
            document.getElementById('cloudflareConfigModal').classList.add('show');

            // ÈªòËÆ§ÈÄâÊã©Á¨¨‰∏Ä‰∏™ÊñπÊ°à
            document.getElementById('cloudflareAuthMethod').value = 'email';
            updateCloudflareAuthMethod();

            // Ê∏ÖÁ©∫ËæìÂÖ•Ê°Ü
            document.getElementById('cloudflareEmail').value = '';
            document.getElementById('cloudflareGlobalAPIKey').value = '';
            document.getElementById('cloudflareAccountID').value = '';
            document.getElementById('cloudflareAPIToken').value = '';

            // ÈáçÁΩÆÁä∂ÊÄÅÂíå‰øùÂ≠òÊåâÈíÆ
            document.getElementById('cloudflareStatus').style.display = 'none';
            document.getElementById('cloudflareStatus').textContent = '';
            document.getElementById('cloudflareConfirmBtn').disabled = true;
            document.getElementById('cloudflareConfirmBtn').style.opacity = '0.5';
            document.getElementById('cloudflareConfirmBtn').dataset.testPassed = 'false';
        }

        // Êõ¥Êñ∞ Cloudflare ËÆ§ËØÅÊñπÊ≥ïÈÄâÊã©Êó∂ÁöÑÊòæÁ§∫
        function updateCloudflareAuthMethod() {
            const method = document.getElementById('cloudflareAuthMethod').value;

            // ÈöêËóèÊâÄÊúâÊñπÊ°àÁöÑËæìÂÖ•Ê°Ü
            document.getElementById('cloudflareEmailSection').style.display = 'none';
            document.getElementById('cloudflareAccountIDSection').style.display = 'none';

            // ÊòæÁ§∫ÈÄâ‰∏≠ÊñπÊ°àÁöÑËæìÂÖ•Ê°Ü
            if (method === 'email') {
                document.getElementById('cloudflareEmailSection').style.display = 'block';
            } else if (method === 'accountid') {
                document.getElementById('cloudflareAccountIDSection').style.display = 'block';
            }

            // ÂàáÊç¢ÊñπÊ°àÊó∂ÈáçÁΩÆÈ™åËØÅÁä∂ÊÄÅÂíå‰øùÂ≠òÊåâÈíÆ
            document.getElementById('cloudflareStatus').style.display = 'none';
            document.getElementById('cloudflareStatus').textContent = '';
            document.getElementById('cloudflareConfirmBtn').disabled = true;
            document.getElementById('cloudflareConfirmBtn').style.opacity = '0.5';
            document.getElementById('cloudflareConfirmBtn').dataset.testPassed = 'false';
        }

        // ÂÖ≥Èó≠ Cloudflare ÈÖçÁΩÆÊ®°ÊÄÅÊ°Ü
        function closeCloudflareConfigModal(event) {
            if (event && event.target.id !== 'cloudflareConfigModal') return;
            document.getElementById('cloudflareConfigModal').classList.remove('show');

            // Ê∏ÖÁ©∫ËæìÂÖ•Ê°ÜÂíåÁä∂ÊÄÅ
            document.getElementById('cloudflareEmail').value = '';
            document.getElementById('cloudflareGlobalAPIKey').value = '';
            document.getElementById('cloudflareAccountID').value = '';
            document.getElementById('cloudflareAPIToken').value = '';
            document.getElementById('cloudflareStatus').style.display = 'none';
            document.getElementById('cloudflareStatus').textContent = '';
        }

        // ÊµãËØï Cloudflare ËøûÊé•
        async function testCloudflareConfig() {
            const method = document.getElementById('cloudflareAuthMethod').value;
            let email = '', globalAPIKey = '', accountID = '', apiToken = '';

            const statusEl = document.getElementById('cloudflareStatus');
            const confirmBtn = document.getElementById('cloudflareConfirmBtn');
            const testBtn = event.target;

            // Ê†πÊçÆÈÄâÊã©ÁöÑÊñπÊ°àËé∑ÂèñËæìÂÖ•ÂÄº
            if (method === 'email') {
                email = document.getElementById('cloudflareEmail').value.trim();
                globalAPIKey = document.getElementById('cloudflareGlobalAPIKey').value.trim();

                if (!email || !globalAPIKey) {
                    statusEl.textContent = '‚ùå ËØ∑Â°´ÂÜô Email Âíå Global API Key';
                    statusEl.style.display = 'block';
                    statusEl.style.background = 'linear-gradient(135deg, #ef4444 0, #dc2626 100%)';
                    statusEl.style.color = '#fff';
                    confirmBtn.disabled = true;
                    confirmBtn.style.opacity = '0.5';
                    confirmBtn.dataset.testPassed = 'false';
                    return;
                }
            } else if (method === 'accountid') {
                accountID = document.getElementById('cloudflareAccountID').value.trim();
                apiToken = document.getElementById('cloudflareAPIToken').value.trim();

                if (!accountID || !apiToken) {
                    statusEl.textContent = '‚ùå ËØ∑Â°´ÂÜô Account ID Âíå API Token';
                    statusEl.style.display = 'block';
                    statusEl.style.background = 'linear-gradient(135deg, #ef4444 0, #dc2626 100%)';
                    statusEl.style.color = '#fff';
                    confirmBtn.disabled = true;
                    confirmBtn.style.opacity = '0.5';
                    confirmBtn.dataset.testPassed = 'false';
                    return;
                }
            }

            try {
                testBtn.disabled = true;
                statusEl.textContent = '‚è≥ Ê£ÄÊµã‰∏≠...';
                statusEl.style.display = 'block';
                statusEl.style.background = 'linear-gradient(135deg, #3b82f6 0, #1d4ed8 100%)';
                statusEl.style.color = '#fff';

                // ÊûÑÂª∫ËØ∑Ê±Ç URL
                let queryParams = new URLSearchParams();
                if (method === 'email') {
                    queryParams.append('Email', email);
                    queryParams.append('GlobalAPIKey', globalAPIKey);
                } else if (method === 'accountid') {
                    queryParams.append('AccountID', accountID);
                    queryParams.append('APIToken', apiToken);
                }

                const response = await fetch('/admin/getCloudflareUsage?' + queryParams.toString());

                if (!response.ok) {
                    throw new Error('ËØ∑Ê±ÇÂ§±Ë¥• (HTTP ' + response.status + ')');
                }

                const data = await response.json();

                if (data.success) {
                    // È™åËØÅÊàêÂäü
                    statusEl.style.background = 'linear-gradient(135deg, #10b981 0, #059669 100%)';
                    const percentage = (data.total / 100000 * 100).toFixed(2);
                    statusEl.textContent = `‚úÖ È™åËØÅÊàêÂäüÔºÅ ‰ªäÂ§©ÁöÑËØ∑Ê±ÇÈÖçÈ¢ù: ${data.total}/100000 (${percentage}%)`;
                    confirmBtn.disabled = false;
                    confirmBtn.style.opacity = '1';
                    confirmBtn.dataset.testPassed = 'true';

                    // ‰øùÂ≠òÈ™åËØÅÈÄöËøáÁöÑÊï∞ÊçÆ‰æõÂêéÁª≠‰øùÂ≠ò‰ΩøÁî®
                    confirmBtn.dataset.method = method;
                    confirmBtn.dataset.email = email;
                    confirmBtn.dataset.globalAPIKey = globalAPIKey;
                    confirmBtn.dataset.accountID = accountID;
                    confirmBtn.dataset.apiToken = apiToken;
                } else {
                    // È™åËØÅÂ§±Ë¥•
                    statusEl.style.background = 'linear-gradient(135deg, #ef4444 0, #dc2626 100%)';
                    statusEl.textContent = '‚ùå È™åËØÅÂ§±Ë¥•ÔºöÂá≠ËØÅÊó†ÊïàÊàñÊó†ÊùÉÈôê';
                    confirmBtn.disabled = true;
                    confirmBtn.style.opacity = '0.5';
                    confirmBtn.dataset.testPassed = 'false';
                }
            } catch (error) {
                statusEl.style.background = 'linear-gradient(135deg, #ef4444 0, #dc2626 100%)';
                statusEl.textContent = '‚ùå Ê£ÄÊµãÂ§±Ë¥•: ' + error.message;
                confirmBtn.disabled = true;
                confirmBtn.style.opacity = '0.5';
                confirmBtn.dataset.testPassed = 'false';
            } finally {
                testBtn.disabled = false;
            }
        }

        // ‰øùÂ≠ò Cloudflare ÈÖçÁΩÆ
        async function confirmCloudflareConfig() {
            const confirmBtn = document.getElementById('cloudflareConfirmBtn');

            // Ê£ÄÊü•ÊòØÂê¶ÈÄöËøá‰∫ÜÈ™åËØÅ
            if (confirmBtn.dataset.testPassed !== 'true') {
                showToast('ËØ∑ÂÖàÁÇπÂáª"ÂèØÁî®ÊÄßÈ™åËØÅ"ÊåâÈíÆÈÄöËøáÈ™åËØÅ', 'error');
                return;
            }

            const method = confirmBtn.dataset.method;
            const email = confirmBtn.dataset.email || '';
            const globalAPIKey = confirmBtn.dataset.globalAPIKey || '';
            const accountID = confirmBtn.dataset.accountID || '';
            const apiToken = confirmBtn.dataset.apiToken || '';

            try {
                confirmBtn.disabled = true;
                confirmBtn.textContent = '‰øùÂ≠ò‰∏≠...';

                // ÊûÑÂª∫ËØ∑Ê±Ç‰Ωì
                const payload = {
                    Email: method === 'email' ? email : null,
                    GlobalAPIKey: method === 'email' ? globalAPIKey : null,
                    AccountID: method === 'accountid' ? accountID : null,
                    APIToken: method === 'accountid' ? apiToken : null
                };

                // Êèê‰∫§Âà∞ÂêéÁ´Ø
                const response = await fetch('/admin/cf.json', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (response.ok) {
                    showToast('‚úÖ Cloudflare ÈÖçÁΩÆÂ∑≤‰øùÂ≠ò', 'success');
                    closeCloudflareConfigModal();

                    // 1ÁßíÂêéÂà∑Êñ∞È°µÈù¢
                    setTimeout(() => {
                        location.reload();
                    }, 1000);
                } else {
                    const errorData = await response.json();
                    showToast('‚ùå ‰øùÂ≠òÂ§±Ë¥•: ' + (errorData.error || 'Êú™Áü•ÈîôËØØ'), 'error');
                    confirmBtn.disabled = false;
                    confirmBtn.textContent = '‰øùÂ≠ò';
                }
            } catch (error) {
                showToast('‚ùå ‰øùÂ≠òÂ§±Ë¥•: ' + error.message, 'error');
                confirmBtn.disabled = false;
                confirmBtn.textContent = '‰øùÂ≠ò';
            }
        }

        // ‰øùÂ≠òÈÄöÁü•ËÆæÁΩÆ
        async function saveNotification() {
            try {
                // Âè™Êõ¥Êñ∞ TG.ÂêØÁî® Â≠óÊÆµ
                if (!currentConfig.TG) currentConfig.TG = {};
                currentConfig.TG.ÂêØÁî® = document.getElementById('telegramEnabled').checked;

                // Êèê‰∫§Âà∞ÊúçÂä°Âô®Ôºå‰ΩÜÊï¥‰∏™ currentConfig
                const response = await fetch('/admin/config.json', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(currentConfig)
                });

                if (!response.ok) throw new Error('‰øùÂ≠òÂ§±Ë¥•');

                showToast('‚úÖ ÂêØÁî®Áä∂ÊÄÅÂ∑≤‰øùÂ≠ò', 'success');
                modifiedSections.delete('notification');
                updateButtonStates();
            } catch (error) {
                showToast('‚ùå ‰øùÂ≠òÂ§±Ë¥•: ' + error.message, 'error');
            }
        }

        // ÂèñÊ∂àÈÄöÁü•ËÆæÁΩÆÁºñËæë
        function cancelEdit(section) {
            if (section === 'notification') {
                // ÈáçÁΩÆÈÄöÁü•ÂêØÁî®Áä∂ÊÄÅ‰∏∫ÂéüÂßãÂÄº
                const telegramCheckbox = document.getElementById('telegramEnabled');
                const originalEnabled = originalConfig.TG?.ÂêØÁî® ?? false;
                telegramCheckbox.checked = originalEnabled;
                currentConfig.TG.ÂêØÁî® = originalEnabled;
            } else {
                // ÂéüÊúâÁöÑcancelEditÈÄªËæë
                currentConfig = JSON.parse(JSON.stringify(originalConfig));

                if (section === 'sub') {
                    const local = currentConfig.‰ºòÈÄâËÆ¢ÈòÖÁîüÊàê?.local ?? true;
                    const randomIP = currentConfig.‰ºòÈÄâËÆ¢ÈòÖÁîüÊàê?.Êú¨Âú∞IPÂ∫ì?.ÈöèÊú∫IP ?? true;

                    if (!local) {
                        document.getElementById('ipMode').value = 'generator';
                        document.getElementById('generatorURL').value = currentConfig.‰ºòÈÄâËÆ¢ÈòÖÁîüÊàê?.SUB || '';
                    } else if (randomIP) {
                        document.getElementById('ipMode').value = 'random';
                        document.getElementById('randomCount').value = currentConfig.‰ºòÈÄâËÆ¢ÈòÖÁîüÊàê?.Êú¨Âú∞IPÂ∫ì?.ÈöèÊú∫Êï∞Èáè || 16;
                    } else {
                        document.getElementById('ipMode').value = 'custom';
                        loadCustomIPs();
                    }
                    updateIPMode();
                } else if (section === 'config') {
                    document.getElementById('subName').value = currentConfig.‰ºòÈÄâËÆ¢ÈòÖÁîüÊàê?.SUBNAME || '';
                    document.getElementById('nodeHost').value = currentConfig.HOST || '';
                    document.getElementById('nodeUUID').value = currentConfig.UUID || '';
                    document.getElementById('protocol').value = currentConfig.ÂçèËÆÆÁ±ªÂûã || 'vless';
                    document.getElementById('skipVerify').checked = currentConfig.Ë∑≥ËøáËØÅ‰π¶È™åËØÅ || false;
                    updateProtocol();
                } else if (section === 'proxy') {
                    const socksEnabled = currentConfig.Âèç‰ª£?.SOCKS5?.ÂêØÁî®;
                    if (!socksEnabled) {
                        document.getElementById('proxyMode').value = 'auto';
                        document.getElementById('proxyIP').value = currentConfig.Âèç‰ª£?.PROXYIP || '';
                        document.getElementById('autoProxy').checked = (currentConfig.Âèç‰ª£?.PROXYIP === 'auto');
                        if (currentConfig.Âèç‰ª£?.PROXYIP === 'auto') {
                            document.getElementById('proxyIP').disabled = true;
                        }
                    } else if (socksEnabled === 'socks5') {
                        document.getElementById('proxyMode').value = 'socks5';
                        document.getElementById('socks5Addr').value = currentConfig.Âèç‰ª£?.SOCKS5?.Ë¥¶Âè∑ || '';
                        document.getElementById('globalSocks5').checked = currentConfig.Âèç‰ª£?.SOCKS5?.ÂÖ®Â±Ä || false;
                    } else if (socksEnabled === 'http') {
                        document.getElementById('proxyMode').value = 'http';
                        document.getElementById('httpAddr').value = currentConfig.Âèç‰ª£?.SOCKS5?.Ë¥¶Âè∑ || '';
                        document.getElementById('globalHTTP').checked = currentConfig.Âèç‰ª£?.SOCKS5?.ÂÖ®Â±Ä || false;
                    }
                    updateProxyMode();
                } else if (section === 'convert') {
                    document.getElementById('subAPI').value = currentConfig.ËÆ¢ÈòÖËΩ¨Êç¢ÈÖçÁΩÆ?.SUBAPI || '';
                    document.getElementById('subConfig').value = currentConfig.ËÆ¢ÈòÖËΩ¨Êç¢ÈÖçÁΩÆ?.SUBCONFIG || '';
                    document.getElementById('emoji').checked = currentConfig.ËÆ¢ÈòÖËΩ¨Êç¢ÈÖçÁΩÆ?.SUBEMOJI || false;
                }
            }

            modifiedSections.delete(section);
            updateButtonStates();
        }

        // Êõ¥Êñ∞ÂÄíËÆ°Êó∂
        function updateCountdown() {
            const now = new Date();
            const nextMidnightUTC = new Date(now);
            nextMidnightUTC.setUTCHours(0, 0, 0, 0);
            nextMidnightUTC.setUTCDate(nextMidnightUTC.getUTCDate() + 1); // ÊÄªÊòØËÆæÁΩÆ‰∏∫ÊòéÂ§©ÁöÑ0ÁÇπ
            
            const diff = nextMidnightUTC - now;
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            document.getElementById('countdown').innerHTML = `<span class="countdown-text">Ë∑ùÁ¶ªÈáçÁΩÆÊó∂Èó¥ËøòÊúâ</span> <span class="countdown-numbers">${hours.toString().padStart(2, '0')}</span><span class="countdown-text">Â∞èÊó∂</span><span class="countdown-numbers">${minutes.toString().padStart(2, '0')}</span><span class="countdown-text">ÂàÜ</span><span class="countdown-numbers">${seconds.toString().padStart(2, '0')}</span><span class="countdown-text">Áßí</span>`;
        }

        // ÂàùÂßãÂåñ
        initializeTheme();
        window.addEventListener('DOMContentLoaded', loadConfig);

        // ÂêØÂä®ÂÄíËÆ°Êó∂Êõ¥Êñ∞
        setInterval(updateCountdown, 1000);
        updateCountdown(); // Á´ãÂç≥ÊâßË°å‰∏ÄÊ¨°
    </script>
</body>

</html>